import{y as _e,B as S,f as Se,b as u,E as Ne,s as Me,q as Q,C as Re,D as je}from"./index-bd60c054.js";import{B as Te}from"./baseSolanaAdapter.esm-be288624.js";import{p as W,d as pe,B as Ie,e as xe}from"./baseControllers.esm-95dce8a3.js";import{b as Y,K as De,V as G}from"./index.browser.esm-8dab0e44.js";import{n as we}from"./nacl-fast-9ae9d9f7.js";const Ke=_e.ec;new Ke("secp256k1");const ee=globalThis.crypto||globalThis.msCrypto||{};ee.subtle||ee.webkitSubtle;S.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex");S.alloc(32,0);var l={},b={};Object.defineProperty(b,"__esModule",{value:!0});b.EthereumProviderError=b.EthereumRpcError=void 0;const ke=Se;class ve extends Error{constructor(e,r,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string.');super(r),this.code=e,n!==void 0&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return ke.default(this.serialize(),He,2)}}b.EthereumRpcError=ve;class $e extends ve{constructor(e,r,n){if(!Le(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,r,n)}}b.EthereumProviderError=$e;function Le(t){return Number.isInteger(t)&&t>=1e3&&t<=4999}function He(t,e){if(e!=="[Circular]")return e}var X={},A={};Object.defineProperty(A,"__esModule",{value:!0});A.errorValues=A.errorCodes=void 0;A.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};A.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.serializeError=t.isValidCode=t.getMessageFromCode=t.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=A,r=b,n=e.errorCodes.rpc.internal,s="Unspecified error message. This is a bug, please report it.",a={code:n,message:i(n)};t.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function i(d,y=s){if(Number.isInteger(d)){const $=d.toString();if(R(e.errorValues,$))return e.errorValues[$].message;if(h(d))return t.JSON_RPC_SERVER_ERROR_MESSAGE}return y}t.getMessageFromCode=i;function c(d){if(!Number.isInteger(d))return!1;const y=d.toString();return!!(e.errorValues[y]||h(d))}t.isValidCode=c;function o(d,{fallbackError:y=a,shouldIncludeStack:$=!1}={}){var V,J;if(!y||!Number.isInteger(y.code)||typeof y.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(d instanceof r.EthereumRpcError)return d.serialize();const P={};if(d&&typeof d=="object"&&!Array.isArray(d)&&R(d,"code")&&c(d.code)){const O=d;P.code=O.code,O.message&&typeof O.message=="string"?(P.message=O.message,R(O,"data")&&(P.data=O.data)):(P.message=i(P.code),P.data={originalError:m(d)})}else{P.code=y.code;const O=(V=d)===null||V===void 0?void 0:V.message;P.message=O&&typeof O=="string"?O:y.message,P.data={originalError:m(d)}}const z=(J=d)===null||J===void 0?void 0:J.stack;return $&&d&&z&&typeof z=="string"&&(P.stack=z),P}t.serializeError=o;function h(d){return d>=-32099&&d<=-32e3}function m(d){return d&&typeof d=="object"&&!Array.isArray(d)?Object.assign({},d):d}function R(d,y){return Object.prototype.hasOwnProperty.call(d,y)}})(X);var q={};Object.defineProperty(q,"__esModule",{value:!0});q.ethErrors=void 0;const Z=b,ye=X,p=A;q.ethErrors={rpc:{parse:t=>w(p.errorCodes.rpc.parse,t),invalidRequest:t=>w(p.errorCodes.rpc.invalidRequest,t),invalidParams:t=>w(p.errorCodes.rpc.invalidParams,t),methodNotFound:t=>w(p.errorCodes.rpc.methodNotFound,t),internal:t=>w(p.errorCodes.rpc.internal,t),server:t=>{if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=t;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return w(e,t)},invalidInput:t=>w(p.errorCodes.rpc.invalidInput,t),resourceNotFound:t=>w(p.errorCodes.rpc.resourceNotFound,t),resourceUnavailable:t=>w(p.errorCodes.rpc.resourceUnavailable,t),transactionRejected:t=>w(p.errorCodes.rpc.transactionRejected,t),methodNotSupported:t=>w(p.errorCodes.rpc.methodNotSupported,t),limitExceeded:t=>w(p.errorCodes.rpc.limitExceeded,t)},provider:{userRejectedRequest:t=>j(p.errorCodes.provider.userRejectedRequest,t),unauthorized:t=>j(p.errorCodes.provider.unauthorized,t),unsupportedMethod:t=>j(p.errorCodes.provider.unsupportedMethod,t),disconnected:t=>j(p.errorCodes.provider.disconnected,t),chainDisconnected:t=>j(p.errorCodes.provider.chainDisconnected,t),custom:t=>{if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:r,data:n}=t;if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string');return new Z.EthereumProviderError(e,r,n)}}};function w(t,e){const[r,n]=Pe(e);return new Z.EthereumRpcError(t,r||ye.getMessageFromCode(t),n)}function j(t,e){const[r,n]=Pe(e);return new Z.EthereumProviderError(t,r||ye.getMessageFromCode(t),n)}function Pe(t){if(t){if(typeof t=="string")return[t];if(typeof t=="object"&&!Array.isArray(t)){const{message:e,data:r}=t;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,r]}}return[]}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageFromCode=t.serializeError=t.EthereumProviderError=t.EthereumRpcError=t.ethErrors=t.errorCodes=void 0;const e=b;Object.defineProperty(t,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(t,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const r=X;Object.defineProperty(t,"serializeError",{enumerable:!0,get:function(){return r.serializeError}}),Object.defineProperty(t,"getMessageFromCode",{enumerable:!0,get:function(){return r.getMessageFromCode}});const n=q;Object.defineProperty(t,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});const s=A;Object.defineProperty(t,"errorCodes",{enumerable:!0,get:function(){return s.errorCodes}})})(l);function re(t,e,r){try{Reflect.apply(t,e,r)}catch(n){setTimeout(()=>{throw n})}}function Fe(t){const e=t.length,r=new Array(e);for(let n=0;n<e;n+=1)r[n]=t[n];return r}class Ue extends Ne{emit(e){let r=e==="error";const n=this._events;if(n!==void 0)r=r&&n.error===void 0;else if(!r)return!1;for(var s=arguments.length,a=new Array(s>1?s-1:0),i=1;i<s;i++)a[i-1]=arguments[i];if(r){let o;if(a.length>0&&([o]=a),o instanceof Error)throw o;const h=new Error(`Unhandled error.${o?` (${o.message})`:""}`);throw h.context=o,h}const c=n[e];if(c===void 0)return!1;if(typeof c=="function")re(c,this,a);else{const o=c.length,h=Fe(c);for(let m=0;m<o;m+=1)re(h[m],this,a)}return!0}}class T extends Error{constructor(e){let{code:r,message:n,data:s}=e;if(!Number.isInteger(r))throw new Error("code must be an integer");if(!n||typeof n!="string")throw new Error("message must be string");super(n),u(this,"code",void 0),u(this,"data",void 0),this.code=r,s!==void 0&&(this.data=s)}toString(){return Me({code:this.code,message:this.message,data:this.data,stack:this.stack})}}function qe(t){return(e,r,n,s)=>{const a=t[e.method];return a===void 0?n():typeof a=="function"?a(e,r,n,s):(r.result=a,s())}}function K(t){return async(e,r,n,s)=>{let a;const i=new Promise(m=>{a=m});let c=null,o=!1;const h=async()=>{o=!0,n(m=>{c=m,a()}),await i};try{await t(e,r,h),o?(await i,c(null)):s(null)}catch(m){c?c(m):s(m)}}}function te(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function Be(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?te(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class v extends Ue{constructor(){super(),u(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,r,n){const s=[];let a=null,i=!1;for(const c of n)if([a,i]=await v._runMiddleware(e,r,c,s),i)break;return[a,i,s.reverse()]}static _runMiddleware(e,r,n,s){return new Promise(a=>{const i=o=>{const h=o||r.error;h&&(r.error=l.serializeError(h)),a([h,!0])},c=o=>{r.error?i(r.error):(o&&(typeof o!="function"&&i(new T({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),s.push(o)),a([null,!1]))};try{n(e,r,c,i)}catch(o){i(o)}})}static async _runReturnHandlers(e){for(const r of e)await new Promise((n,s)=>{r(a=>a?s(a):n())})}static _checkForCompletion(e,r,n){if(!("result"in r)&&!("error"in r))throw new T({code:-32603,message:"Response has no error or result for request"});if(!n)throw new T({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,r){if(r&&typeof r!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?r?this._handleBatch(e,r):this._handleBatch(e):r?this._handle(e,r):this._promiseHandle(e)}asMiddleware(){return async(e,r,n,s)=>{try{const[a,i,c]=await v._runAllMiddleware(e,r,this._middleware);return i?(await v._runReturnHandlers(c),s(a)):n(async o=>{try{await v._runReturnHandlers(c)}catch(h){return o(h)}return o()})}catch(a){return s(a)}}}async _handleBatch(e,r){try{const n=await Promise.all(e.map(this._promiseHandle.bind(this)));return r?r(null,n):n}catch(n){if(r)return r(n);throw n}}_promiseHandle(e){return new Promise(r=>{this._handle(e,(n,s)=>{r(s)})})}async _handle(e,r){if(!e||Array.isArray(e)||typeof e!="object"){const i=new T({code:-32603,message:"request must be plain object"});return r(i,{id:void 0,jsonrpc:"2.0",error:i})}if(typeof e.method!="string"){const i=new T({code:-32603,message:"method must be string"});return r(i,{id:e.id,jsonrpc:"2.0",error:i})}const n=Be({},e),s={id:n.id,jsonrpc:n.jsonrpc};let a=null;try{await this._processRequest(n,s)}catch(i){a=i}return a&&(delete s.result,s.error||(s.error=l.serializeError(a))),r(a,s)}async _processRequest(e,r){const[n,s,a]=await v._runAllMiddleware(e,r,this._middleware);if(v._checkForCompletion(e,r,s),await v._runReturnHandlers(a),n)throw n}}function k(t){const e=new v;return t.forEach(r=>e.push(r)),e.asMiddleware()}const I="openlogin_store";Q.setLevel("error");Q.getLogger("openlogin");class Ve{constructor(){u(this,"store",{})}getItem(e){return this.store[e]||null}setItem(e,r){this.store[e]=r}}function Ee(t){let e=!1,r=0,n;try{n=window[t],e=!0,r=n.length;const s="__storage_test__";return n.setItem(s,s),n.removeItem(s),!0}catch(s){return s&&(s.code===22||s.code===1014||s.name==="QuotaExceededErro r"||s.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&r!==0}}const Je=Ee("sessionStorage"),ze=Ee("localStorage");class Ge{constructor(e,r){u(this,"storage",void 0),u(this,"_storeKey",I),this.storage=e,this._storeKey=r||I;try{e.getItem(r||I)||this.resetStore()}catch{}}static getInstance(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){let n=new Ve;r==="local"&&ze&&(n=localStorage),r==="session"&&Je&&(n=sessionStorage);const s=e?`${I}_${e}`:I;this.instance=new this(n,s)}return this.instance}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey))}get(e){return JSON.parse(this.storage.getItem(this._storeKey))[e]}set(e,r){const n=JSON.parse(this.storage.getItem(this._storeKey));n[e]=r,this.storage.setItem(this._storeKey,JSON.stringify(n))}}u(Ge,"instance",void 0);const F={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},Ye={EIP155:"eip155",SOLANA:"solana",MULTICHAIN:"multichain"};class B extends Re{constructor(e,r){super(r),u(this,"code",void 0),u(this,"message",void 0),this.code=e,this.message=r||"",Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class g extends B{constructor(e,r){super(e,r),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new g(e,`${g.messages[e]}, ${r}`)}static notFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5001,e)}static notInstalled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5002,e)}static notReady(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5003,e)}static windowBlocked(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5004,e)}static windowClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5005,e)}static incompatibleChainNameSpace(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5006,e)}static duplicateAdapterError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5007,e)}static invalidProviderConfigError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5008,e)}static providerNotReadyError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5009,e)}static rpcConnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5010,e)}static invalidParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5011,e)}static invalidNetwork(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return g.fromCode(5013,e)}}u(g,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class f extends B{constructor(e,r){super(e,r),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new f(e,`${f.messages[e]}. ${r}`)}static connectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5111,e)}static disconnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5112,e)}static notConnectedError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5113,e)}static popupClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5114,e)}static mfaEnabled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5115,e)}static chainConfigNotAdded(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5116,e)}static unsupportedOperation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5117,e)}static coreKitKeyNotFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5118,e)}static userNotLoggedIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f.fromCode(5119,e)}}u(f,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class M extends B{constructor(e,r){super(e,r),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new M(e,`${M.messages[e]}, ${r}`)}static chainIDNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return M.fromCode(5201,e)}static operationNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return M.fromCode(5202,e)}}u(M,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});function ne(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function U(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ne(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const D={OPENLOGIN:"openlogin",WALLET_CONNECT_V1:"wallet-connect-v1",WALLET_CONNECT_V2:"wallet-connect-v2"},x=U({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLFLARE:"solflare",SLOPE:"slope"},D),H=U({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},D),L=U(U({},H),x);D.OPENLOGIN+"",D.WALLET_CONNECT_V1+"",D.WALLET_CONNECT_V2+"",x.TORUS_SOLANA+"",x.PHANTOM+"",x.SOLFLARE+"",x.SLOPE+"",H.TORUS_EVM+"",H.METAMASK+"",H.COINBASE+"";function se(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function ie(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?se(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const Qe={EXTERNAL:"external",IN_APP:"in_app"},E={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},N=ie(ie({},E),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});var ae=Q.getLogger("web3auth-logger");function oe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function ce(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?oe(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class Oe extends Ie{constructor(e){let{config:r,state:n}=e;if(super({config:r,state:n}),u(this,"_providerEngineProxy",null),!r.chainConfig)throw g.invalidProviderConfigError("Please provide chainConfig");if(!r.chainConfig.chainId)throw g.invalidProviderConfigError("Please provide chainId inside chainConfig");if(!r.chainConfig.rpcTarget)throw g.invalidProviderConfigError("Please provide rpcTarget inside chainConfig");this.defaultState={chainId:"loading"},this.defaultConfig={chainConfig:r.chainConfig,networks:{[r.chainConfig.chainId]:r.chainConfig}},super.initialize()}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){if(!e.chainId||!e.rpcTarget)throw l.ethErrors.rpc.invalidParams("chainId is required");this.configure({networks:ce(ce({},this.config.networks),{},{[e.chainId]:e})})}getChainConfig(e){var r;const n=(r=this.config.networks)===null||r===void 0?void 0:r[e];if(!n)throw l.ethErrors.rpc.invalidRequest(`Chain ${e} is not supported, please add chainConfig for it`);return n}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=pe(e)}}class de{constructor(){u(this,"_providerEngineProxy",null)}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){throw new Error("Method not implemented.")}async setupProvider(e){const r=this.getPrivKeyMiddleware(e),n=new v;n.push(r);const s=W(n);this.updateProviderEngineProxy(s)}async switchChain(e){return Promise.resolve()}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=pe(e)}getPrivKeyMiddleware(e){const r={getPrivatekey:async()=>e};return this.createPrivKeyMiddleware(r)}createPrivKeyMiddleware(e){let{getPrivatekey:r}=e;async function n(s,a){a.result=await r()}return qe({private_key:K(n)})}}u(de,"getProviderInstance",async t=>{const e=new de;return await e.setupProvider(t.privKey),e});je();const _=we.lowlevel;function We(t){let e;typeof t=="string"?e=S.from(t,"hex"):e=t;const r=new Uint8Array(64),n=[_.gf(),_.gf(),_.gf(),_.gf()],s=new Uint8Array([...new Uint8Array(e),...new Uint8Array(32)]),a=new Uint8Array(32);_.crypto_hash(r,s,32),r[0]&=248,r[31]&=127,r[31]|=64,_.scalarbase(n,r),_.pack(a,n);for(let i=0;i<32;i+=1)s[i+32]=a[i];return{sk:S.from(s),pk:S.from(a)}}function Xe(t){return(e,r,n,s)=>e.method==="solana_chainId"?(r.result=t,s()):n()}function Ze(t){return(e,r,n,s)=>e.method==="solana_provider_config"?(r.result=t,s()):n()}function Ce(t){const{chainId:e}=t;return k([Xe(e),Ze(t)])}function er(t){const{rpcTarget:e}=t,r=xe({rpcTarget:e});return{networkMiddleware:k([Ce(t),r]),fetchMiddleware:r}}function rr(t){let{getAccounts:e}=t;return K(async(r,n,s)=>{const{method:a}=r;if(a!=="getAccounts")return s();if(!e)throw new Error("WalletMiddleware - opts.getAccounts not provided");const i=await e(r);n.result=i})}function tr(t){let{requestAccounts:e}=t;return K(async(r,n,s)=>{const{method:a}=r;if(a!=="requestAccounts")return s();if(!e)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const i=await e(r);n.result=i})}function C(t,e){return K(async(r,n,s)=>{const{method:a}=r;if(a!==t)return s();if(!e)throw new Error(`WalletMiddleware - ${t} not provided`);const i=await e(r);n.result=i})}function be(t){const{getAccounts:e,requestAccounts:r,signTransaction:n,signAndSendTransaction:s,signAllTransactions:a,signMessage:i,getPrivateKey:c,getSecretKey:o}=t;return k([tr({requestAccounts:r}),rr({getAccounts:e}),C("signTransaction",n),C("signAndSendTransaction",s),C("signAllTransactions",a),C("signMessage",i),C("solanaPrivateKey",c),C("private_key",c),C("solanaSecretKey",o)])}function nr(t){let{addNewChainConfig:e,switchSolanaChain:r}=t;return k([C("addSolanaChain",e),C("switchSolanaChain",r)])}function sr(t){let{updatePrivatekey:e}=t;return k([C("updateAccount",e)])}function ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function le(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ue(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class ir extends Oe{constructor(e){let{config:r,state:n}=e;super({config:{chainConfig:le(le({},r.chainConfig),{},{chainNamespace:F.SOLANA})},state:n})}async switchChain(e){throw f.unsupportedOperation("Chain switching is not supported by this adapter")}async setupProvider(e){const r=new v,n=this.getProviderHandlers(e),s=be(n);r.push(s);const a=Ce(this.config.chainConfig);r.push(a);const i=this.getInjectedProviderProxy(e);i&&r.push(i);const c=W(r);this.updateProviderEngineProxy(c),await this.lookupNetwork()}async lookupNetwork(){const{chainConfig:e}=this.config;return this.update({chainId:e.chainId}),e.chainId||""}getInjectedProviderProxy(e){}}const ar=t=>({requestAccounts:async()=>t.publicKey?[Y.encode(t.publicKey.toBytes())]:[],getAccounts:async()=>t.publicKey?[Y.encode(t.publicKey.toBytes())]:[],getPrivateKey:async()=>{throw l.ethErrors.rpc.methodNotSupported()},getSecretKey:async()=>{throw l.ethErrors.rpc.methodNotSupported()},signTransaction:async r=>await t.signTransaction(r.params.message),signMessage:async r=>(await t.signMessage(r.params.message,r.params.display)).signature,signAllTransactions:async r=>{var n,s;if(!((n=r.params)!==null&&n!==void 0&&n.message)||!((s=r.params)!==null&&s!==void 0&&s.message.length))throw l.ethErrors.rpc.invalidParams("message");return await t.signAllTransactions(r.params.message)},signAndSendTransaction:async r=>({signature:(await t.signAndSendTransaction(r.params.message)).signature})});function he(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function or(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?he(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function cr(t){return K(async(e,r,n)=>{const s=await t.request(or({},e));r.result=s})}class dr extends ir{getProviderHandlers(e){return ar(e)}getInjectedProviderProxy(e){return cr(e)}}async function ur(t){let{privKey:e,getProviderEngineProxy:r}=t;const n=()=>De.fromSecretKey(S.from(e,"hex"));if(typeof e!="string")throw g.invalidParams("privKey must be a string");const s=n();return{requestAccounts:async()=>[s.publicKey.toBase58()],getAccounts:async()=>[s.publicKey.toBase58()],getPrivateKey:async()=>e,getSecretKey:async()=>Y.encode(s.secretKey),signTransaction:async i=>{var c;if(!((c=i.params)!==null&&c!==void 0&&c.message))throw l.ethErrors.rpc.invalidParams("message");const o=i.params.message;return o.version!==void 0||o instanceof G?o.sign([s]):o.partialSign(s),o},signMessage:async i=>{var c;if(!((c=i.params)!==null&&c!==void 0&&c.message))throw l.ethErrors.rpc.invalidParams("message");return we.sign.detached(i.params.message,s.secretKey)},signAndSendTransaction:async i=>{var c;if(!((c=i.params)!==null&&c!==void 0&&c.message))throw l.ethErrors.rpc.invalidParams("message");const o=r();if(!o)throw l.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const h=i.params.message;return h.version!==void 0||h instanceof G?h.sign([s]):h.partialSign(s),{signature:await o.request({method:"sendTransaction",params:[S.from(h.serialize()).toString("base64"),{encoding:"base64",preflightCommitment:"confirmed"}]})}},signAllTransactions:async i=>{var c,o,h;if(!((c=i.params)!==null&&c!==void 0&&c.message)||!((o=i.params)!==null&&o!==void 0&&o.message.length))throw l.ethErrors.rpc.invalidParams("message");const m=(h=i.params)===null||h===void 0?void 0:h.message;for(const R of m||[]){const d=R;d.version!==void 0||d instanceof G?d.sign([s]):d.partialSign(s)}return m}}}function ge(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function fe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ge(Object(r),!0).forEach(function(n){u(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}class me extends Oe{constructor(e){let{config:r,state:n}=e;super({config:{chainConfig:fe(fe({},r.chainConfig),{},{chainNamespace:F.SOLANA})},state:n})}async enable(){if(!this.state.privateKey)throw l.ethErrors.provider.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}getEd25519Key(e){return We(e).sk.toString("hex")}async setupProvider(e){const r=await ur({privKey:e,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)}),n=be(r),s=new v,{networkMiddleware:a}=er(this.config.chainConfig);s.push(this.getChainSwitchMiddleware()),s.push(this.getAccountMiddleware()),s.push(n),s.push(a);const i=W(s);this.updateProviderEngineProxy(i),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw l.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this._providerEngineProxy.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw l.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const r=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:r});const n=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(n)}async lookupNetwork(){if(!this._providerEngineProxy)throw l.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:r}=this.config;if(e!=="ok")throw g.rpcConnectionError(`Failed to lookup network for following rpc target: ${r.rpcTarget}`);return this.update({chainId:r.chainId}),this.state.chainId!==r.chainId&&(this.provider.emit("chainChanged",this.state.chainId),this.provider.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return nr({addNewChainConfig:async n=>{if(!n.params)throw l.ethErrors.rpc.invalidParams("Missing request params");const{chainId:s,chainName:a,rpcUrls:i,blockExplorerUrls:c,nativeCurrency:o}=n.params;if(!s)throw l.ethErrors.rpc.invalidParams("Missing chainId in chainParams");if(!i||i.length===0)throw l.ethErrors.rpc.invalidParams("Missing rpcUrls in chainParams");if(!o)throw l.ethErrors.rpc.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:F.SOLANA,chainId:s,ticker:o?.symbol||"SOL",tickerName:o?.name||"Solana",displayName:a,rpcTarget:i[0],blockExplorer:c?.[0]||"",decimals:o?.decimals||9})},switchSolanaChain:async n=>{if(!n.params)throw l.ethErrors.rpc.invalidParams("Missing request params");if(!n.params.chainId)throw l.ethErrors.rpc.invalidParams("Missing chainId");await this.switchChain(n.params)}})}getAccountMiddleware(){return sr({updatePrivatekey:async r=>{if(!r.params)throw l.ethErrors.rpc.invalidParams("Missing request params");if(!r.params.privateKey)throw l.ethErrors.rpc.invalidParams("Missing privateKey");const{privateKey:n}=r.params;await this.updateAccount({privateKey:n})}})}}u(me,"getProviderInstance",async t=>{const e=new me({config:{chainConfig:t.chainConfig}});return await e.setupProvider(t.privKey),e});function Ae(t,e,r){return new Promise((n,s)=>{r>0?setTimeout(async()=>{const a=await t();a&&n(a),a||Ae(t,e,r-1).then(i=>(n(i),i)).catch(i=>s(i))},e):n(!1)})}const lr=async function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{interval:1e3,count:3};return typeof window<"u"&&!!((t=window.solana)!==null&&t!==void 0&&t.isPhantom)||await Ae(()=>{var s;return(s=window.solana)===null||s===void 0?void 0:s.isPhantom},e.interval,e.count)?window.solana:null};class wr extends Te{constructor(){super(...arguments),u(this,"name",L.PHANTOM),u(this,"adapterNamespace",Ye.SOLANA),u(this,"currentChainNamespace",F.SOLANA),u(this,"type",Qe.EXTERNAL),u(this,"status",E.NOT_READY),u(this,"_wallet",null),u(this,"phantomProvider",null),u(this,"_onDisconnect",()=>{this._wallet&&(this._wallet.off("disconnect",this._onDisconnect),this.rehydrated=!1,this.status=this.status===E.CONNECTED?E.READY:E.NOT_READY,this.emit(N.DISCONNECTED))})}get isWalletConnected(){var e;return!!((e=this._wallet)!==null&&e!==void 0&&e.isConnected&&this.status===E.CONNECTED)}get provider(){var e;return((e=this.phantomProvider)===null||e===void 0?void 0:e.provider)||null}set provider(e){throw new Error("Not implemented")}async init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(await super.init(e),super.checkInitializationRequirements(),this._wallet=await lr({interval:500,count:3}),!this._wallet)throw g.notInstalled();this.phantomProvider=new dr({config:{chainConfig:this.chainConfig}}),this.status=E.READY,this.emit(N.READY,L.PHANTOM);try{ae.debug("initializing phantom adapter"),e.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(r){ae.error("Failed to connect with cached phantom provider",r),this.emit("ERRORED",r)}}async connect(){var e=this;try{if(super.checkConnectionRequirements(),this.status=E.CONNECTING,this.emit(N.CONNECTING,{adapter:L.PHANTOM}),!this._wallet)throw g.notInstalled();if(this._wallet.isConnected)await this.connectWithProvider(this._wallet);else{const r=this._wallet._handleDisconnect;try{await new Promise((n,s)=>{const a=async()=>{await this.connectWithProvider(this._wallet),n(this.provider)};if(!this._wallet){s(g.notInstalled());return}this._wallet.once("connect",a),this._wallet._handleDisconnect=function(){s(g.windowClosed());for(var i=arguments.length,c=new Array(i),o=0;o<i;o++)c[o]=arguments[o];return r.apply(e._wallet,c)},this._wallet.connect().catch(i=>{s(i)})})}catch(n){throw n instanceof B?n:f.connectionError(n?.message)}finally{this._wallet._handleDisconnect=r}}if(!this._wallet.publicKey)throw f.connectionError();return this._wallet.on("disconnect",this._onDisconnect),this.provider}catch(r){throw this.status=E.READY,this.rehydrated=!1,this.emit(N.ERRORED,r),r}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession();try{var r;await((r=this._wallet)===null||r===void 0?void 0:r.disconnect()),e.cleanup&&(this.status=E.NOT_READY,this.phantomProvider=null,this._wallet=null),await super.disconnect()}catch(n){this.emit(N.ERRORED,f.disconnectionError(n?.message))}}async getUserInfo(){if(!this.isWalletConnected)throw f.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async addChain(e){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(n),(r=this.phantomProvider)===null||r===void 0||r.addChain(e),this.addChainConfig(e)}async switchChain(e){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(e,n),await((r=this.phantomProvider)===null||r===void 0?void 0:r.switchChain(e)),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}async connectWithProvider(e){if(!this.phantomProvider)throw f.connectionError("No phantom provider");return await this.phantomProvider.setupProvider(e),this.status=E.CONNECTED,this.emit(N.CONNECTED,{adapter:L.PHANTOM,reconnected:this.rehydrated}),this.provider}}export{wr as PhantomAdapter};
