import{r as Rt,f as ut,a as he,b as c,E as lt,o as Tt,e as Ne,s as ht,q as ge,B as O,p as Me,x as jt,y as Nt,C as Mt,D as Dt}from"./index-081e9748.js";import{P as De,K as kt,b as xt,V as ve}from"./index.browser.esm-2615c930.js";import{C as D,P as Lt,c as $t,a as z,b as Ee,p as Se,d as gt,B as Kt,e as Ut}from"./baseControllers.esm-4fdb1339.js";import{d as qt,i as Ft}from"./index-540a3e55.js";import{B as Ht}from"./baseSolanaAdapter.esm-856c6872.js";import{n as mt}from"./nacl-fast-07737457.js";const zt=()=>Rt(32).toString("hex");var N={},L={};Object.defineProperty(L,"__esModule",{value:!0});L.EthereumProviderError=L.EthereumRpcError=void 0;const Wt=ut;let pt=class extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string.');super(t),this.code=e,r!==void 0&&(this.data=r)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return Wt.default(this.serialize(),Gt,2)}};L.EthereumRpcError=pt;let Bt=class extends pt{constructor(e,t,r){if(!Vt(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}};L.EthereumProviderError=Bt;function Vt(n){return Number.isInteger(n)&&n>=1e3&&n<=4999}function Gt(n,e){if(e!=="[Circular]")return e}var Ae={},$={};Object.defineProperty($,"__esModule",{value:!0});$.errorValues=$.errorCodes=void 0;$.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};$.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeError=n.isValidCode=n.getMessageFromCode=n.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=$,t=L,r=e.errorCodes.rpc.internal,s="Unspecified error message. This is a bug, please report it.",i={code:r,message:o(r)};n.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function o(u,m=s){if(Number.isInteger(u)){const E=u.toString();if(g(e.errorValues,E))return e.errorValues[E].message;if(l(u))return n.JSON_RPC_SERVER_ERROR_MESSAGE}return m}n.getMessageFromCode=o;function d(u){if(!Number.isInteger(u))return!1;const m=u.toString();return!!(e.errorValues[m]||l(u))}n.isValidCode=d;function a(u,{fallbackError:m=i,shouldIncludeStack:E=!1}={}){var R,C;if(!m||!Number.isInteger(m.code)||typeof m.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(u instanceof t.EthereumRpcError)return u.serialize();const f={};if(u&&typeof u=="object"&&!Array.isArray(u)&&g(u,"code")&&d(u.code)){const v=u;f.code=v.code,v.message&&typeof v.message=="string"?(f.message=v.message,g(v,"data")&&(f.data=v.data)):(f.message=o(f.code),f.data={originalError:h(u)})}else{f.code=m.code;const v=(R=u)===null||R===void 0?void 0:R.message;f.message=v&&typeof v=="string"?v:m.message,f.data={originalError:h(u)}}const T=(C=u)===null||C===void 0?void 0:C.stack;return E&&u&&T&&typeof T=="string"&&(f.stack=T),f}n.serializeError=a;function l(u){return u>=-32099&&u<=-32e3}function h(u){return u&&typeof u=="object"&&!Array.isArray(u)?Object.assign({},u):u}function g(u,m){return Object.prototype.hasOwnProperty.call(u,m)}})(Ae);var me={};Object.defineProperty(me,"__esModule",{value:!0});me.ethErrors=void 0;const Ie=L,ft=Ae,_=$;me.ethErrors={rpc:{parse:n=>S(_.errorCodes.rpc.parse,n),invalidRequest:n=>S(_.errorCodes.rpc.invalidRequest,n),invalidParams:n=>S(_.errorCodes.rpc.invalidParams,n),methodNotFound:n=>S(_.errorCodes.rpc.methodNotFound,n),internal:n=>S(_.errorCodes.rpc.internal,n),server:n=>{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=n;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return S(e,n)},invalidInput:n=>S(_.errorCodes.rpc.invalidInput,n),resourceNotFound:n=>S(_.errorCodes.rpc.resourceNotFound,n),resourceUnavailable:n=>S(_.errorCodes.rpc.resourceUnavailable,n),transactionRejected:n=>S(_.errorCodes.rpc.transactionRejected,n),methodNotSupported:n=>S(_.errorCodes.rpc.methodNotSupported,n),limitExceeded:n=>S(_.errorCodes.rpc.limitExceeded,n)},provider:{userRejectedRequest:n=>W(_.errorCodes.provider.userRejectedRequest,n),unauthorized:n=>W(_.errorCodes.provider.unauthorized,n),unsupportedMethod:n=>W(_.errorCodes.provider.unsupportedMethod,n),disconnected:n=>W(_.errorCodes.provider.disconnected,n),chainDisconnected:n=>W(_.errorCodes.provider.chainDisconnected,n),custom:n=>{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:t,data:r}=n;if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string');return new Ie.EthereumProviderError(e,t,r)}}};function S(n,e){const[t,r]=wt(e);return new Ie.EthereumRpcError(n,t||ft.getMessageFromCode(n),r)}function W(n,e){const[t,r]=wt(e);return new Ie.EthereumProviderError(n,t||ft.getMessageFromCode(n),r)}function wt(n){if(n){if(typeof n=="string")return[n];if(typeof n=="object"&&!Array.isArray(n)){const{message:e,data:t}=n;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMessageFromCode=n.serializeError=n.EthereumProviderError=n.EthereumRpcError=n.ethErrors=n.errorCodes=void 0;const e=L;Object.defineProperty(n,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(n,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const t=Ae;Object.defineProperty(n,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(n,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});const r=me;Object.defineProperty(n,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});const s=$;Object.defineProperty(n,"errorCodes",{enumerable:!0,get:function(){return s.errorCodes}})})(N);function ne(){}const ke="SYN",_e="ACK",xe="BRK";class Le extends he.Duplex{constructor(e){let{name:t,target:r,targetWindow:s=window,targetOrigin:i="*"}=e;if(super({objectMode:!0}),c(this,"_init",void 0),c(this,"_haveSyn",void 0),c(this,"_name",void 0),c(this,"_target",void 0),c(this,"_targetWindow",void 0),c(this,"_targetOrigin",void 0),c(this,"_onMessage",void 0),c(this,"_synIntervalId",void 0),!t||!r)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=t,this._target=r,this._targetWindow=s,this._targetOrigin=i,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(xe,null,ne),this._haveSyn=!1,this._init=!1}_handShake(){this._write(ke,null,ne),this.cork()}_onData(e){if(!this._init)e===ke?(this._haveSyn=!0,this._write(_e,null,ne)):e===_e&&(this._init=!0,this._haveSyn||this._write(_e,null,ne),this.uncork());else if(e===xe)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,r){this._postMessage(e),r()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function $e(n,e,t){try{Reflect.apply(n,e,t)}catch(r){setTimeout(()=>{throw r})}}function Jt(n){const e=n.length,t=new Array(e);for(let r=0;r<e;r+=1)t[r]=n[r];return t}let pe=class extends lt{emit(e){let t=e==="error";const r=this._events;if(r!==void 0)t=t&&r.error===void 0;else if(!t)return!1;for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];if(t){let a;if(i.length>0&&([a]=i),a instanceof Error)throw a;const l=new Error(`Unhandled error.${a?` (${a.message})`:""}`);throw l.context=a,l}const d=r[e];if(d===void 0)return!1;if(typeof d=="function")$e(d,this,i);else{const a=d.length,l=Jt(d);for(let h=0;h<a;h+=1)$e(l[h],this,i)}return!0}},B=class extends Error{constructor(e){let{code:t,message:r,data:s}=e;if(!Number.isInteger(t))throw new Error("code must be an integer");if(!r||typeof r!="string")throw new Error("message must be string");super(r),c(this,"code",void 0),c(this,"data",void 0),this.code=t,s!==void 0&&(this.data=s)}toString(){return ht({code:this.code,message:this.message,data:this.data,stack:this.stack})}};const Ce=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(r,s)=>{r||s.error?e(r||s.error):!t||Array.isArray(s)?n(s):n(s.result)}};function Yt(){const n={};function e(){return!1}const t=new pe;function r(a){const l=n[a.id];if(!l)throw new Error(`StreamMiddleware - Unknown response id "${a.id}"`);delete n[a.id],Object.assign(l.res,a),setTimeout(l.end)}function s(a){t.emit("notification",a)}function i(a,l,h){let g;try{!a.id?s(a):r(a)}catch(u){g=u}h(g)}const o=new he.Duplex({objectMode:!0,read:e,write:i});return{events:t,middleware:(a,l,h,g)=>{o.push(a),n[a.id]={req:a,res:l,next:h,end:g}},stream:o}}function Zt(){return(n,e,t,r)=>{const s=n.id,i=zt();n.id=i,e.id=i,t(o=>{n.id=s,e.id=s,o()})}}function Ke(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Qt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ke(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ke(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}let Xt=class x extends pe{constructor(){super(),c(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,t,r){const s=[];let i=null,o=!1;for(const d of r)if([i,o]=await x._runMiddleware(e,t,d,s),o)break;return[i,o,s.reverse()]}static _runMiddleware(e,t,r,s){return new Promise(i=>{const o=a=>{const l=a||t.error;l&&(t.error=N.serializeError(l)),i([l,!0])},d=a=>{t.error?o(t.error):(a&&(typeof a!="function"&&o(new B({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),s.push(a)),i([null,!1]))};try{r(e,t,d,o)}catch(a){o(a)}})}static async _runReturnHandlers(e){for(const t of e)await new Promise((r,s)=>{t(i=>i?s(i):r())})}static _checkForCompletion(e,t,r){if(!("result"in t)&&!("error"in t))throw new B({code:-32603,message:"Response has no error or result for request"});if(!r)throw new B({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?this._handleBatch(e,t):this._handleBatch(e):t?this._handle(e,t):this._promiseHandle(e)}asMiddleware(){return async(e,t,r,s)=>{try{const[i,o,d]=await x._runAllMiddleware(e,t,this._middleware);return o?(await x._runReturnHandlers(d),s(i)):r(async a=>{try{await x._runReturnHandlers(d)}catch(l){return a(l)}return a()})}catch(i){return s(i)}}}async _handleBatch(e,t){try{const r=await Promise.all(e.map(this._promiseHandle.bind(this)));return t?t(null,r):r}catch(r){if(t)return t(r);throw r}}_promiseHandle(e){return new Promise(t=>{this._handle(e,(r,s)=>{t(s)})})}async _handle(e,t){if(!e||Array.isArray(e)||typeof e!="object"){const o=new B({code:-32603,message:"request must be plain object"});return t(o,{id:void 0,jsonrpc:"2.0",error:o})}if(typeof e.method!="string"){const o=new B({code:-32603,message:"method must be string"});return t(o,{id:e.id,jsonrpc:"2.0",error:o})}const r=Qt({},e),s={id:r.id,jsonrpc:r.jsonrpc};let i=null;try{await this._processRequest(r,s)}catch(o){i=o}return i&&(delete s.result,s.error||(s.error=N.serializeError(i))),t(i,s)}async _processRequest(e,t){const[r,s,i]=await x._runAllMiddleware(e,t,this._middleware);if(x._checkForCompletion(e,t,s),await x._runReturnHandlers(i),r)throw r}};class er extends he.Duplex{constructor(e){let{parent:t,name:r}=e;super({objectMode:!0}),c(this,"_parent",void 0),c(this,"_name",void 0),this._parent=t,this._name=r}_read(){}_write(e,t,r){this._parent.push({name:this._name,data:e}),r()}}function Ue(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function qe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ue(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ue(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const Fe=Symbol("IGNORE_SUBSTREAM");class tr extends he.Duplex{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(qe(qe({},e),{},{objectMode:!0})),c(this,"_substreams",void 0),c(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new er({parent:this,name:e});return this._substreams[e]=t,rr(this,r=>t.destroy(r||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Fe}_read(){}_write(e,t,r){const{name:s,data:i}=e;if(!s)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),r();const o=this._substreams[s];return o?(o!==Fe&&o.push(i),r()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${s}"`),r())}}function rr(n,e){const t=Tt(e);Ne(n,{readable:!1},t),Ne(n,{writable:!1},t)}var nr="0.3.4",k={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",unsupportedSync:n=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${n} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:n=>`Invalid options. Received: { maxEventListeners: ${n}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:n=>`'args.logger' must include required method '${n}'.`},info:{connected:n=>`Torus: Connected to chain with ID "${n}".`},warnings:{}};const sr={PRODUCTION:"production",DEVELOPMENT:"development",TESTING:"testing"},Y={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},Pe={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless"},ir={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}};var Re={supportedVerifierList:[Pe.GOOGLE,Pe.REDDIT,Pe.DISCORD],api:"https://api.tor.us",translations:ir,prodTorusUrl:"",localStorageKeyPrefix:"torus-"},w=ge.getLogger("solana-embed");function or(){return(n,e,t)=>{(typeof n.method!="string"||!n.method)&&(e.error=N.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:n})),t(r=>{const{error:s}=e;return s&&w.error(`Torus - RPC Error: ${s.message}`,s),r()})}}function ar(n,e,t){let r=`Torus: Lost connection to "${n}".`;e?.stack&&(r+=`
${e.stack}`),w.warn(r),t&&t.listenerCount("error")>0&&t.emit("error",r)}const se=()=>Math.random().toString(36).slice(2),yt=async n=>{let e,t;switch(n){case"testing":e="https://solana-testing.tor.us",t="debug";break;case"development":e="http://localhost:8080",t="debug";break;default:e="https://solana.tor.us",t="error";break}return{torusUrl:e,logLevel:t}},dr=()=>{let n=window.navigator.language||"en-US";const e=n.split("-");return n=Object.prototype.hasOwnProperty.call(Re.translations,e[0])?e[0]:"en",n},cr={height:660,width:375},ur={height:740,width:1315},lr={height:700,width:1200},vt={height:600,width:400};function hr(n){let e;try{e=window[n];const t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(t){return t&&(t.code===22||t.code===1014||t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}function Q(n){let{width:e,height:t}=n;const r=window.screenLeft!==void 0?window.screenLeft:window.screenX,s=window.screenTop!==void 0?window.screenTop:window.screenY,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,d=1,a=Math.abs((i-e)/2/d+r),l=Math.abs((o-t)/2/d+s);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${t/d},width=${e/d},top=${l},left=${a}`}let Et=class extends pe{constructor(e,t){let{maxEventListeners:r=100,jsonRpcStreamName:s="provider"}=t;if(super(),c(this,"isTorus",void 0),c(this,"_rpcEngine",void 0),c(this,"jsonRpcConnectionEvents",void 0),c(this,"_state",void 0),!Ft.duplex(e))throw new Error(k.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(r),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this);const i=new tr;Me(e,i,e,this._handleStreamDisconnect.bind(this,"Torus")),i.ignoreStream("phishing");const o=Yt();Me(o.stream,i.createStream(s),o.stream,this._handleStreamDisconnect.bind(this,"Torus RpcProvider"));const d=new Xt;d.push(Zt()),d.push(or()),d.push($t({origin:location.origin})),d.push(o.middleware),this._rpcEngine=d,this.jsonRpcConnectionEvents=o.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw N.ethErrors.rpc.invalidRequest({message:k.errors.invalidRequestArgs(),data:e});const{method:t,params:r}=e;if(typeof t!="string"||t.length===0)throw N.ethErrors.rpc.invalidRequest({message:k.errors.invalidRequestMethod(),data:e});if(r!==void 0&&!Array.isArray(r)&&(typeof r!="object"||r===null))throw N.ethErrors.rpc.invalidRequest({message:k.errors.invalidRequestParams(),data:e});return new Promise((s,i)=>{this._rpcRequest({method:t,params:r},Ce(s,i))})}send(e,t){this._rpcRequest(e,t)}sendAsync(e){return new Promise((t,r)=>{this._rpcRequest(e,Ce(t,r))})}_handleStreamDisconnect(e,t){ar(e,t,this),this._handleDisconnect(!1,t?t.message:void 0)}};const gr=function(n,e,t){for(var r=arguments.length,s=new Array(r>3?r-3:0),i=3;i<r;i++)s[i-3]=arguments[i];const o=()=>{t(...s),n.removeEventListener(e,o)};n.addEventListener(e,o)};async function _t(){return new Promise(n=>{document.readyState!=="loading"?n():gr(document,"DOMContentLoaded",n)})}const H=n=>{const e=window.document.createElement("template"),t=n.trim();return e.innerHTML=t,e.content.firstChild};function ie(n){return n.version===void 0}class Pt extends pe{constructor(e){let{url:t,target:r,features:s}=e;super(),c(this,"url",void 0),c(this,"target",void 0),c(this,"features",void 0),c(this,"window",void 0),c(this,"windowTimer",void 0),c(this,"iClosedWindow",void 0),this.url=t,this.target=r||"_blank",this.features=s||Q(lr),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){return this.window=window.open(this.url.href,this.target,this.features),this.window?.focus&&this.window.focus(),Promise.resolve()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}function He(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function mr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?He(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):He(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class fe extends Et{constructor(e,t){let{maxEventListeners:r=100,jsonRpcStreamName:s="provider"}=t;super(e,{maxEventListeners:r,jsonRpcStreamName:s}),c(this,"embedTranslations",void 0),c(this,"torusUrl",void 0),c(this,"dappStorageKey",void 0),c(this,"windowRefs",void 0),c(this,"tryWindowHandle",void 0),c(this,"torusAlertContainer",void 0),c(this,"torusIframe",void 0),this._state=mr({},fe._defaultState),this.torusUrl="",this.dappStorageKey="";const i=Re.translations[dr()];this.embedTranslations=i.embed,this.windowRefs={},this.on("connect",()=>{this._state.isConnected=!0});const o=d=>{const{method:a,params:l}=d;if(a===z.IFRAME_STATUS){const{isFullScreen:h,rid:g}=l;this._displayIframe({isFull:h,rid:g})}else if(a===z.CREATE_WINDOW){const{windowId:h,url:g}=l;this._createPopupBlockAlert(h,g)}else if(a===z.CLOSE_WINDOW)this._handleCloseWindow(l);else if(a===z.USER_LOGGED_IN){const{currentLoginProvider:h}=l;this._state.isLoggedIn=!0,this._state.currentLoginProvider=h}else a===z.USER_LOGGED_OUT&&(this._state.isLoggedIn=!1,this._state.currentLoginProvider=null,this._displayIframe())};this.jsonRpcConnectionEvents.on("notification",o)}get isLoggedIn(){return this._state.isLoggedIn}get isIFrameFullScreen(){return this._state.isIFrameFullScreen}isConnected(){return this._state.isConnected}async _initializeState(e){try{const{torusUrl:t,dappStorageKey:r,torusAlertContainer:s,torusIframe:i}=e;this.torusUrl=t,this.dappStorageKey=r,this.torusAlertContainer=s,this.torusIframe=i,this.torusIframe.addEventListener("load",()=>{this._state.isIFrameFullScreen||this._displayIframe()});const{currentLoginProvider:o,isLoggedIn:d}=await this.request({method:D.GET_PROVIDER_STATE,params:[]});this._handleConnect(o,d)}catch(t){w.error("Torus: Failed to get initial state. Please report this bug.",t)}finally{w.info("initialized communication state"),this._state.initialized=!0,this.emit("_initialized")}}_handleWindow(e){let{url:t,target:r,features:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new URL(t||`${this.torusUrl}/redirect?windowId=${e}`);this.dappStorageKey&&(i.hash?i.hash+=`&dappStorageKey=${this.dappStorageKey}`:i.hash=`#dappStorageKey=${this.dappStorageKey}`);const o=new Pt({url:i,target:r,features:s});if(o.open(),!o.window){this._createPopupBlockAlert(e,i.href);return}this.windowRefs[e]=o,this.request({method:D.OPENED_WINDOW,params:{windowId:e}}),o.once("close",()=>{delete this.windowRefs[e],this.request({method:D.CLOSED_WINDOW,params:{windowId:e}})})}_displayIframe(){let{isFull:e=!1,rid:t=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={};if(e)r.display="block",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px";else switch(r.display=this._state.torusWidgetVisibility?"block":"none",r.height="70px",r.width="70px",this._state.buttonPosition){case Y.TOP_LEFT:r.top="0px",r.left="0px",r.right="auto",r.bottom="auto";break;case Y.TOP_RIGHT:r.top="0px",r.right="0px",r.left="auto",r.bottom="auto";break;case Y.BOTTOM_RIGHT:r.bottom="0px",r.right="0px",r.top="auto",r.left="auto";break;case Y.BOTTOM_LEFT:default:r.bottom="0px",r.left="0px",r.top="auto",r.right="auto";break}Object.assign(this.torusIframe.style,r),this._state.isIFrameFullScreen=e,this.request({method:D.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:t}})}hideTorusButton(){this._state.torusWidgetVisibility=!1,this._displayIframe()}showTorusButton(){this._state.torusWidgetVisibility=!0,this._displayIframe()}_rpcRequest(e,t){const r=t,s=e;Array.isArray(s)||s.jsonrpc||(s.jsonrpc="2.0"),this.tryWindowHandle(s,r)}_handleConnect(e,t){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{currentLoginProvider:e,isLoggedIn:t}),w.debug(k.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let r;e?(r=new N.EthereumRpcError(1013,t||k.errors.disconnected()),w.debug(r)):(r=new N.EthereumRpcError(1011,t||k.errors.permanentlyDisconnected()),w.error(r),this._state.currentLoginProvider=null,this._state.isLoggedIn=!1,this._state.torusWidgetVisibility=!1,this._state.isIFrameFullScreen=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleCloseWindow(e){const{windowId:t}=e;this.windowRefs[t]&&(this.windowRefs[t].close(),delete this.windowRefs[t])}async _createPopupBlockAlert(e,t){const r=this.getLogoUrl(),s=H(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${r}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),i=H(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),o=H('<div id="torusAlert__btn-container"></div>');o.appendChild(i),s.appendChild(o);const d=()=>{i.addEventListener("click",()=>{this._handleWindow(e,{url:t,target:"_blank",features:Q(vt)}),s.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})},a=()=>{this.torusAlertContainer.appendChild(s)};await _t(),a(),d(),this.torusAlertContainer.style.display="block"}getLogoUrl(){return`${this.torusUrl}/images/torus_icon-blue.svg`}}c(fe,"_defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,hasEmittedConnection:!1,torusWidgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1});function ze(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function pr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ze(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ze(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class we extends Et{constructor(e,t){let{maxEventListeners:r=100,jsonRpcStreamName:s="provider"}=t;super(e,{maxEventListeners:r,jsonRpcStreamName:s}),c(this,"chainId",void 0),c(this,"selectedAddress",void 0),c(this,"tryWindowHandle",void 0),this._state=pr({},we._defaultState),this.selectedAddress=null,this.chainId=null,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this.on("connect",()=>{this._state.isConnected=!0});const i=o=>{const{method:d,params:a}=o;d===Ee.ACCOUNTS_CHANGED?this._handleAccountsChanged(a):d===Ee.UNLOCK_STATE_CHANGED?this._handleUnlockStateChanged(a):d===Ee.CHAIN_CHANGED&&this._handleChainChanged(a)};this.jsonRpcConnectionEvents.on("notification",i)}isConnected(){return this._state.isConnected}async _initializeState(){try{const{accounts:e,chainId:t,isUnlocked:r}=await this.request({method:Lt.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:t}),this._handleChainChanged({chainId:t}),this._handleUnlockStateChanged({accounts:e,isUnlocked:r}),this._handleAccountsChanged(e)}catch(e){w.error("Torus: Failed to get initial state. Please report this bug.",e)}finally{w.info("initialized provider state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=t;const i=e;if(!Array.isArray(i)){if(i.jsonrpc||(i.jsonrpc="2.0"),i.method==="solana_accounts"||i.method==="solana_requestAccounts")s=(o,d)=>{this._handleAccountsChanged(d.result||[],i.method==="solana_accounts",r),t(o,d)};else if(i.method==="wallet_getProviderState"){this._rpcEngine.handle(e,s);return}}this.tryWindowHandle(i,s)}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),w.debug(k.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let r;e?(r=new N.EthereumRpcError(1013,t||k.errors.disconnected()),w.debug(r)):(r=new N.EthereumRpcError(1011,t||k.errors.permanentlyDisconnected()),w.error(r),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleAccountsChanged(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=e;Array.isArray(s)||(w.error("Torus: Received non-array accounts parameter. Please report this bug.",s),s=[]);for(const i of e)if(typeof i!="string"){w.error("Torus: Received non-string account. Please report this bug.",e),s=[];break}qt(this._state.accounts,s)||(t&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!r&&w.error('Torus: "solana_accounts" unexpectedly updated accounts. Please report this bug.',s),this._state.accounts=s,this.emit("accountsChanged",s)),this.selectedAddress!==s[0]&&(this.selectedAddress=s[0]||null)}_handleChainChanged(){let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!e){w.error("Torus: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this._handleDisconnect(!0):(this._handleConnect(e),e!==this.chainId&&(this.chainId=e,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:e,isUnlocked:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof t!="boolean"){w.error("Torus: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this._state.isUnlocked&&(this._state.isUnlocked=t,this._handleAccountsChanged(e||[]))}}c(we,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function We(n){return new Promise((e,t)=>{try{const r=document.createElement("img");r.onload=()=>e(!0),r.onerror=()=>e(!1),r.src=n}catch(r){t(r)}})}const fr=n=>{const{document:e}=n,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const r=e.querySelector('head > meta[name="title"]');return r?r.content:e.title&&e.title.length>0?e.title:n.location.hostname};async function wr(n){try{const{document:e}=n;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await We(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(r=>!!r.href),t&&await We(t.href))?t.href:""}catch{return""}}const yr=async()=>({name:fr(window),icon:await wr(window)});function Be(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function be(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Be(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Be(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const vr=["send_transaction","sign_transaction","sign_all_transactions","sign_message","connect"],Er=[D.SET_PROVIDER],_r=hr("localStorage");(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{torusUrl:t}=await yt("production");e.href=`${t}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){w.warn(e)}})();class Pr{constructor(){let{modalZIndex:e=99999}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};c(this,"isInitialized",void 0),c(this,"torusAlert",void 0),c(this,"modalZIndex",void 0),c(this,"alertZIndex",void 0),c(this,"requestedLoginProvider",void 0),c(this,"provider",void 0),c(this,"communicationProvider",void 0),c(this,"dappStorageKey",void 0),c(this,"isTopupHidden",!1),c(this,"torusAlertContainer",void 0),c(this,"torusUrl",void 0),c(this,"torusIframe",void 0),c(this,"styleLink",void 0),this.torusUrl="",this.isInitialized=!1,this.requestedLoginProvider=null,this.modalZIndex=e,this.alertZIndex=e+1e3,this.dappStorageKey=""}get isLoggedIn(){return this.communicationProvider?this.communicationProvider.isLoggedIn:!1}async init(){let{buildEnv:e=sr.PRODUCTION,enableLogging:t=!1,network:r,showTorusButton:s=!1,useLocalStorage:i=!1,buttonPosition:o=Y.BOTTOM_LEFT,apiKey:d="torus-default",extraParams:a={},whiteLabel:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");jt(d);const{torusUrl:h,logLevel:g}=await yt(e);w.enableAll(),w.info(h,"url loaded"),w.info(`Solana Embed Version :${nr}`),this.torusUrl=h,w.setDefaultLevel(g),t?w.enableAll():w.disableAll();const u=this.handleDappStorageKey(i),m=new URL(h);m.pathname.endsWith("/")?m.pathname+="frame":m.pathname+="/frame";const E=new URLSearchParams;u&&E.append("dappStorageKey",u),E.append("origin",window.location.origin),m.hash=E.toString(),this.torusIframe=H(`<iframe
        id="torusIframe"
        class="torusIframe"
        src="${m.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()}"
      ></iframe>`),this.torusAlertContainer=H(`<div id="torusAlertContainer" style="display:none; z-index: ${this.alertZIndex.toString()}"></div>`),this.styleLink=H(`<link href="${h}/css/widget.css" rel="stylesheet" type="text/css">`);const R=async()=>new Promise((C,f)=>{try{window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer),this.torusIframe.addEventListener("load",async()=>{const T=await yr();this.torusIframe.contentWindow.postMessage({buttonPosition:o,apiKey:d,network:r,dappMetadata:T,extraParams:a,whiteLabel:l},m.origin),await this._setupWeb3({torusUrl:h}),s&&this.showTorusButton(),l?.topupHide?this.isTopupHidden=l.topupHide:this.hideTorusButton(),this.isInitialized=!0,window.torus=this,C()})}catch(T){f(T)}});await _t(),await R()}async login(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");try{this.requestedLoginProvider=e.loginProvider||null,this.requestedLoginProvider||this.communicationProvider._displayIframe({isFull:!0});const t=await new Promise((r,s)=>{this.provider._rpcRequest({method:"solana_requestAccounts",params:[this.requestedLoginProvider,e.login_hint]},Ce(r,s))});if(Array.isArray(t)&&t.length>0)return t;throw new Error("Login failed")}catch(t){throw w.error("login failed",t),t}finally{this.communicationProvider.isIFrameFullScreen&&this.communicationProvider._displayIframe()}}async loginWithPrivateKey(e){if(!this.isInitialized)throw new Error("Call init() first");const{privateKey:t,userInfo:r}=e,{success:s}=await this.communicationProvider.request({method:"login_with_private_key",params:{privateKey:t,userInfo:r}});if(!s)throw new Error("Login Failed")}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:D.LOGOUT,params:[]}),this.requestedLoginProvider=null}async cleanUp(){this.communicationProvider.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(t){return t instanceof Element||t instanceof Document}e(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),e(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),e(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.communicationProvider.hideTorusButton()}showTorusButton(){this.communicationProvider.showTorusButton()}async setProvider(e){await this.communicationProvider.request({method:D.SET_PROVIDER,params:be({},e)})}async showWallet(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=await this.communicationProvider.request({method:D.WALLET_INSTANCE_ID,params:[]}),s=e?`/${e}`:"",i=new URL(`${this.torusUrl}/wallet${s}`);i.searchParams.append("instanceId",r),Object.keys(t).forEach(d=>{i.searchParams.append(d,t[d])}),this.dappStorageKey&&(i.hash=`#dappStorageKey=${this.dappStorageKey}`),new Pt({url:i,features:Q(ur)}).open()}async getUserInfo(){return await this.communicationProvider.request({method:D.USER_INFO,params:[]})}async initiateTopup(e,t){if(!this.isInitialized)throw new Error("Torus is not initialized");const r=se();return this.communicationProvider._handleWindow(r),await this.communicationProvider.request({method:D.TOPUP,params:{provider:e,params:t,windowId:r}})}async getAccounts(){return await this.provider.request({method:"getAccounts",params:[]})}async sendTransaction(e){const t=ie(e),r=t?e.serialize({requireAllSignatures:!1}).toString("hex"):O.from(e.serialize()).toString("hex");return await this.provider.request({method:"send_transaction",params:{message:r,isLegacyTransaction:t}})}async signAndSendTransaction(e,t){const r=ie(e),s=r?e.serialize({requireAllSignatures:!1}).toString("hex"):O.from(e.serialize()).toString("hex");return{signature:await this.provider.request({method:"send_transaction",params:{message:s,options:t,isLegacyTransaction:r}})}}async signTransaction(e){const t=ie(e),r=t?e.serializeMessage().toString("hex"):O.from(e.message.serialize()).toString("hex"),s=await this.provider.request({method:"sign_transaction",params:{message:r,messageOnly:!0,isLegacyTransaction:t}}),i=JSON.parse(s),o={publicKey:new De(i.publicKey),signature:O.from(i.signature,"hex")};return e.addSignature(o.publicKey,o.signature),e}async signAllTransactions(e){let t;const r=e.map(o=>(t=ie(o),t?o.serializeMessage().toString("hex"):O.from(o.message.serialize()).toString("hex"))),i=(await this.provider.request({method:"sign_all_transactions",params:{message:r,messageOnly:!0,isLegacyTransaction:t}})).map(o=>{const d=JSON.parse(o);return{publicKey:new De(d.publicKey),signature:O.from(d.signature,"hex")}});return e.forEach((o,d)=>(o.addSignature(i[d].publicKey,i[d].signature),o)),e}async signMessage(e){return await this.provider.request({method:"sign_message",params:{data:e}})}async getGaslessPublicKey(){return await this.provider.request({method:"get_gasless_public_key",params:[]})}handleDappStorageKey(e){const t=`${Re.localStorageKeyPrefix}${window.location.hostname}`;let r="";if(_r&&e){const s=window.localStorage.getItem(t);if(s)r=s;else{const i=`torus-app-${se()}`;window.localStorage.setItem(t,i),r=i}}return this.dappStorageKey=r,r}async _setupWeb3(e){w.info("setupWeb3 running");const t=new Le({name:"embed_torus",target:"iframe_torus",targetWindow:this.torusIframe.contentWindow}),r=new Le({name:"embed_communication",target:"iframe_communication",targetWindow:this.torusIframe.contentWindow}),s=new we(t,{}),i=new fe(r,{});s.tryWindowHandle=(l,h)=>{const g=l;if(!Array.isArray(g)&&vr.includes(g.method)){if(!this.communicationProvider.isLoggedIn)throw new Error("User Not Logged In");const u=se();i._handleWindow(u,{target:"_blank",features:Q(vt)}),g.windowId=u}s._rpcEngine.handle(g,h)},i.tryWindowHandle=(l,h)=>{const g=l;if(!Array.isArray(g)&&Er.includes(g.method)){const u=se();i._handleWindow(u,{target:"_blank",features:Q(cr)}),g.params.windowId=u}i._rpcEngine.handle(g,h)};const o=l=>{const h=s[l],g=this;s[l]=function(m,E){const{method:R,params:C=[]}=m;if(R==="solana_requestAccounts"){if(!E)return g.login({loginProvider:C[0]});g.login({loginProvider:C[0]}).then(f=>E(null,f)).catch(f=>E(f))}return h.apply(this,[m,E])}};o("request"),o("sendAsync"),o("send");const d=new Proxy(s,{deleteProperty:()=>!0}),a=new Proxy(i,{deleteProperty:()=>!0});this.provider=d,this.communicationProvider=a,await Promise.all([s._initializeState(),i._initializeState(be(be({},e),{},{dappStorageKey:this.dappStorageKey,torusAlertContainer:this.torusAlertContainer,torusIframe:this.torusIframe}))]),w.debug("Torus - injected provider")}}const br=Nt.ec;new br("secp256k1");const Ve=globalThis.crypto||globalThis.msCrypto||{};Ve.subtle||Ve.webkitSubtle;O.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex");O.alloc(32,0);var p={},K={};Object.defineProperty(K,"__esModule",{value:!0});K.EthereumProviderError=K.EthereumRpcError=void 0;const Or=ut;class bt extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string.');super(t),this.code=e,r!==void 0&&(this.data=r)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return Or.default(this.serialize(),Ar,2)}}K.EthereumRpcError=bt;class Cr extends bt{constructor(e,t,r){if(!Sr(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}}K.EthereumProviderError=Cr;function Sr(n){return Number.isInteger(n)&&n>=1e3&&n<=4999}function Ar(n,e){if(e!=="[Circular]")return e}var Te={},U={};Object.defineProperty(U,"__esModule",{value:!0});U.errorValues=U.errorCodes=void 0;U.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};U.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeError=n.isValidCode=n.getMessageFromCode=n.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=U,t=K,r=e.errorCodes.rpc.internal,s="Unspecified error message. This is a bug, please report it.",i={code:r,message:o(r)};n.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function o(u,m=s){if(Number.isInteger(u)){const E=u.toString();if(g(e.errorValues,E))return e.errorValues[E].message;if(l(u))return n.JSON_RPC_SERVER_ERROR_MESSAGE}return m}n.getMessageFromCode=o;function d(u){if(!Number.isInteger(u))return!1;const m=u.toString();return!!(e.errorValues[m]||l(u))}n.isValidCode=d;function a(u,{fallbackError:m=i,shouldIncludeStack:E=!1}={}){var R,C;if(!m||!Number.isInteger(m.code)||typeof m.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(u instanceof t.EthereumRpcError)return u.serialize();const f={};if(u&&typeof u=="object"&&!Array.isArray(u)&&g(u,"code")&&d(u.code)){const v=u;f.code=v.code,v.message&&typeof v.message=="string"?(f.message=v.message,g(v,"data")&&(f.data=v.data)):(f.message=o(f.code),f.data={originalError:h(u)})}else{f.code=m.code;const v=(R=u)===null||R===void 0?void 0:R.message;f.message=v&&typeof v=="string"?v:m.message,f.data={originalError:h(u)}}const T=(C=u)===null||C===void 0?void 0:C.stack;return E&&u&&T&&typeof T=="string"&&(f.stack=T),f}n.serializeError=a;function l(u){return u>=-32099&&u<=-32e3}function h(u){return u&&typeof u=="object"&&!Array.isArray(u)?Object.assign({},u):u}function g(u,m){return Object.prototype.hasOwnProperty.call(u,m)}})(Te);var ye={};Object.defineProperty(ye,"__esModule",{value:!0});ye.ethErrors=void 0;const je=K,Ot=Te,P=U;ye.ethErrors={rpc:{parse:n=>A(P.errorCodes.rpc.parse,n),invalidRequest:n=>A(P.errorCodes.rpc.invalidRequest,n),invalidParams:n=>A(P.errorCodes.rpc.invalidParams,n),methodNotFound:n=>A(P.errorCodes.rpc.methodNotFound,n),internal:n=>A(P.errorCodes.rpc.internal,n),server:n=>{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=n;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return A(e,n)},invalidInput:n=>A(P.errorCodes.rpc.invalidInput,n),resourceNotFound:n=>A(P.errorCodes.rpc.resourceNotFound,n),resourceUnavailable:n=>A(P.errorCodes.rpc.resourceUnavailable,n),transactionRejected:n=>A(P.errorCodes.rpc.transactionRejected,n),methodNotSupported:n=>A(P.errorCodes.rpc.methodNotSupported,n),limitExceeded:n=>A(P.errorCodes.rpc.limitExceeded,n)},provider:{userRejectedRequest:n=>V(P.errorCodes.provider.userRejectedRequest,n),unauthorized:n=>V(P.errorCodes.provider.unauthorized,n),unsupportedMethod:n=>V(P.errorCodes.provider.unsupportedMethod,n),disconnected:n=>V(P.errorCodes.provider.disconnected,n),chainDisconnected:n=>V(P.errorCodes.provider.chainDisconnected,n),custom:n=>{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:t,data:r}=n;if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string');return new je.EthereumProviderError(e,t,r)}}};function A(n,e){const[t,r]=Ct(e);return new je.EthereumRpcError(n,t||Ot.getMessageFromCode(n),r)}function V(n,e){const[t,r]=Ct(e);return new je.EthereumProviderError(n,t||Ot.getMessageFromCode(n),r)}function Ct(n){if(n){if(typeof n=="string")return[n];if(typeof n=="object"&&!Array.isArray(n)){const{message:e,data:t}=n;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMessageFromCode=n.serializeError=n.EthereumProviderError=n.EthereumRpcError=n.ethErrors=n.errorCodes=void 0;const e=K;Object.defineProperty(n,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(n,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const t=Te;Object.defineProperty(n,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(n,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});const r=ye;Object.defineProperty(n,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});const s=U;Object.defineProperty(n,"errorCodes",{enumerable:!0,get:function(){return s.errorCodes}})})(p);function Ge(n,e,t){try{Reflect.apply(n,e,t)}catch(r){setTimeout(()=>{throw r})}}function Ir(n){const e=n.length,t=new Array(e);for(let r=0;r<e;r+=1)t[r]=n[r];return t}class Rr extends lt{emit(e){let t=e==="error";const r=this._events;if(r!==void 0)t=t&&r.error===void 0;else if(!t)return!1;for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];if(t){let a;if(i.length>0&&([a]=i),a instanceof Error)throw a;const l=new Error(`Unhandled error.${a?` (${a.message})`:""}`);throw l.context=a,l}const d=r[e];if(d===void 0)return!1;if(typeof d=="function")Ge(d,this,i);else{const a=d.length,l=Ir(d);for(let h=0;h<a;h+=1)Ge(l[h],this,i)}return!0}}class G extends Error{constructor(e){let{code:t,message:r,data:s}=e;if(!Number.isInteger(t))throw new Error("code must be an integer");if(!r||typeof r!="string")throw new Error("message must be string");super(r),c(this,"code",void 0),c(this,"data",void 0),this.code=t,s!==void 0&&(this.data=s)}toString(){return ht({code:this.code,message:this.message,data:this.data,stack:this.stack})}}function Tr(n){return(e,t,r,s)=>{const i=n[e.method];return i===void 0?r():typeof i=="function"?i(e,t,r,s):(t.result=i,s())}}function te(n){return async(e,t,r,s)=>{let i;const o=new Promise(h=>{i=h});let d=null,a=!1;const l=async()=>{a=!0,r(h=>{d=h,i()}),await o};try{await n(e,t,l),a?(await o,d(null)):s(null)}catch(h){d?d(h):s(h)}}}function Je(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function jr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Je(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Je(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class I extends Rr{constructor(){super(),c(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,t,r){const s=[];let i=null,o=!1;for(const d of r)if([i,o]=await I._runMiddleware(e,t,d,s),o)break;return[i,o,s.reverse()]}static _runMiddleware(e,t,r,s){return new Promise(i=>{const o=a=>{const l=a||t.error;l&&(t.error=p.serializeError(l)),i([l,!0])},d=a=>{t.error?o(t.error):(a&&(typeof a!="function"&&o(new G({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),s.push(a)),i([null,!1]))};try{r(e,t,d,o)}catch(a){o(a)}})}static async _runReturnHandlers(e){for(const t of e)await new Promise((r,s)=>{t(i=>i?s(i):r())})}static _checkForCompletion(e,t,r){if(!("result"in t)&&!("error"in t))throw new G({code:-32603,message:"Response has no error or result for request"});if(!r)throw new G({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?this._handleBatch(e,t):this._handleBatch(e):t?this._handle(e,t):this._promiseHandle(e)}asMiddleware(){return async(e,t,r,s)=>{try{const[i,o,d]=await I._runAllMiddleware(e,t,this._middleware);return o?(await I._runReturnHandlers(d),s(i)):r(async a=>{try{await I._runReturnHandlers(d)}catch(l){return a(l)}return a()})}catch(i){return s(i)}}}async _handleBatch(e,t){try{const r=await Promise.all(e.map(this._promiseHandle.bind(this)));return t?t(null,r):r}catch(r){if(t)return t(r);throw r}}_promiseHandle(e){return new Promise(t=>{this._handle(e,(r,s)=>{t(s)})})}async _handle(e,t){if(!e||Array.isArray(e)||typeof e!="object"){const o=new G({code:-32603,message:"request must be plain object"});return t(o,{id:void 0,jsonrpc:"2.0",error:o})}if(typeof e.method!="string"){const o=new G({code:-32603,message:"method must be string"});return t(o,{id:e.id,jsonrpc:"2.0",error:o})}const r=jr({},e),s={id:r.id,jsonrpc:r.jsonrpc};let i=null;try{await this._processRequest(r,s)}catch(o){i=o}return i&&(delete s.result,s.error||(s.error=p.serializeError(i))),t(i,s)}async _processRequest(e,t){const[r,s,i]=await I._runAllMiddleware(e,t,this._middleware);if(I._checkForCompletion(e,t,s),await I._runReturnHandlers(i),r)throw r}}function re(n){const e=new I;return n.forEach(t=>e.push(t)),e.asMiddleware()}const J="openlogin_store";ge.setLevel("error");ge.getLogger("openlogin");class Nr{constructor(){c(this,"store",{})}getItem(e){return this.store[e]||null}setItem(e,t){this.store[e]=t}}function St(n){let e=!1,t=0,r;try{r=window[n],e=!0,t=r.length;const s="__storage_test__";return r.setItem(s,s),r.removeItem(s),!0}catch(s){return s&&(s.code===22||s.code===1014||s.name==="QuotaExceededErro r"||s.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&t!==0}}const Mr=St("sessionStorage"),Dr=St("localStorage");class kr{constructor(e,t){c(this,"storage",void 0),c(this,"_storeKey",J),this.storage=e,this._storeKey=t||J;try{e.getItem(t||J)||this.resetStore()}catch{}}static getInstance(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){let r=new Nr;t==="local"&&Dr&&(r=localStorage),t==="session"&&Mr&&(r=sessionStorage);const s=e?`${J}_${e}`:J;this.instance=new this(r,s)}return this.instance}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey))}get(e){return JSON.parse(this.storage.getItem(this._storeKey))[e]}set(e,t){const r=JSON.parse(this.storage.getItem(this._storeKey));r[e]=t,this.storage.setItem(this._storeKey,JSON.stringify(r))}}c(kr,"instance",void 0);const ue={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},xr={EIP155:"eip155",SOLANA:"solana",MULTICHAIN:"multichain"};class ee extends Mt{constructor(e,t){super(t),c(this,"code",void 0),c(this,"message",void 0),this.code=e,this.message=t||"",Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class y extends ee{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new y(e,`${y.messages[e]}, ${t}`)}static notFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5001,e)}static notInstalled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5002,e)}static notReady(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5003,e)}static windowBlocked(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5004,e)}static windowClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5005,e)}static incompatibleChainNameSpace(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5006,e)}static duplicateAdapterError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5007,e)}static invalidProviderConfigError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5008,e)}static providerNotReadyError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5009,e)}static rpcConnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5010,e)}static invalidParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5011,e)}static invalidNetwork(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return y.fromCode(5013,e)}}c(y,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class b extends ee{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new b(e,`${b.messages[e]}. ${t}`)}static connectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5111,e)}static disconnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5112,e)}static notConnectedError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5113,e)}static popupClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5114,e)}static mfaEnabled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5115,e)}static chainConfigNotAdded(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5116,e)}static unsupportedOperation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5117,e)}static coreKitKeyNotFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5118,e)}static userNotLoggedIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return b.fromCode(5119,e)}}c(b,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class F extends ee{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new F(e,`${F.messages[e]}, ${t}`)}static chainIDNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return F.fromCode(5201,e)}static operationNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return F.fromCode(5202,e)}}c(F,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});function Ye(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function le(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ye(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ye(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const X={OPENLOGIN:"openlogin",WALLET_CONNECT_V1:"wallet-connect-v1",WALLET_CONNECT_V2:"wallet-connect-v2"},Z=le({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLFLARE:"solflare",SLOPE:"slope"},X),ce=le({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},X),oe=le(le({},ce),Z);X.OPENLOGIN+"",X.WALLET_CONNECT_V1+"",X.WALLET_CONNECT_V2+"",Z.TORUS_SOLANA+"",Z.PHANTOM+"",Z.SOLFLARE+"",Z.SLOPE+"",ce.TORUS_EVM+"",ce.METAMASK+"",ce.COINBASE+"";function Ze(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Qe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ze(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ze(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const Lr={EXTERNAL:"external",IN_APP:"in_app"},j={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},ae=Qe(Qe({},j),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});var Oe=ge.getLogger("web3auth-logger");const Xe=n=>(typeof n=="string"||typeof n=="number")&&/^(-)?0x[0-9a-f]*$/i.test(n);function et(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function tt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?et(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):et(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class At extends Kt{constructor(e){let{config:t,state:r}=e;if(super({config:t,state:r}),c(this,"_providerEngineProxy",null),!t.chainConfig)throw y.invalidProviderConfigError("Please provide chainConfig");if(!t.chainConfig.chainId)throw y.invalidProviderConfigError("Please provide chainId inside chainConfig");if(!t.chainConfig.rpcTarget)throw y.invalidProviderConfigError("Please provide rpcTarget inside chainConfig");this.defaultState={chainId:"loading"},this.defaultConfig={chainConfig:t.chainConfig,networks:{[t.chainConfig.chainId]:t.chainConfig}},super.initialize()}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){if(!e.chainId||!e.rpcTarget)throw p.ethErrors.rpc.invalidParams("chainId is required");this.configure({networks:tt(tt({},this.config.networks),{},{[e.chainId]:e})})}getChainConfig(e){var t;const r=(t=this.config.networks)===null||t===void 0?void 0:t[e];if(!r)throw p.ethErrors.rpc.invalidRequest(`Chain ${e} is not supported, please add chainConfig for it`);return r}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=gt(e)}}class rt{constructor(){c(this,"_providerEngineProxy",null)}get provider(){return this._providerEngineProxy}set provider(e){throw new Error("Method not implemented.")}addChain(e){throw new Error("Method not implemented.")}async setupProvider(e){const t=this.getPrivKeyMiddleware(e),r=new I;r.push(t);const s=Se(r);this.updateProviderEngineProxy(s)}async switchChain(e){return Promise.resolve()}getProviderEngineProxy(){return this._providerEngineProxy}updateProviderEngineProxy(e){this._providerEngineProxy?this._providerEngineProxy.setTarget(e):this._providerEngineProxy=gt(e)}getPrivKeyMiddleware(e){const t={getPrivatekey:async()=>e};return this.createPrivKeyMiddleware(t)}createPrivKeyMiddleware(e){let{getPrivatekey:t}=e;async function r(s,i){i.result=await t()}return Tr({private_key:te(r)})}}c(rt,"getProviderInstance",async n=>{const e=new rt;return await e.setupProvider(n.privKey),e});Dt();const q=mt.lowlevel;function $r(n){let e;typeof n=="string"?e=O.from(n,"hex"):e=n;const t=new Uint8Array(64),r=[q.gf(),q.gf(),q.gf(),q.gf()],s=new Uint8Array([...new Uint8Array(e),...new Uint8Array(32)]),i=new Uint8Array(32);q.crypto_hash(t,s,32),t[0]&=248,t[31]&=127,t[31]|=64,q.scalarbase(r,t),q.pack(i,r);for(let o=0;o<32;o+=1)s[o+32]=i[o];return{sk:O.from(s),pk:O.from(i)}}function Kr(n){return(e,t,r,s)=>e.method==="solana_chainId"?(t.result=n,s()):r()}function Ur(n){return(e,t,r,s)=>e.method==="solana_provider_config"?(t.result=n,s()):r()}function qr(n){const{chainId:e}=n;return re([Kr(e),Ur(n)])}function Fr(n){const{rpcTarget:e}=n,t=Ut({rpcTarget:e});return{networkMiddleware:re([qr(n),t]),fetchMiddleware:t}}function Hr(n){let{getAccounts:e}=n;return te(async(t,r,s)=>{const{method:i}=t;if(i!=="getAccounts")return s();if(!e)throw new Error("WalletMiddleware - opts.getAccounts not provided");const o=await e(t);r.result=o})}function zr(n){let{requestAccounts:e}=n;return te(async(t,r,s)=>{const{method:i}=t;if(i!=="requestAccounts")return s();if(!e)throw new Error("WalletMiddleware - opts.requestAccounts not provided");const o=await e(t);r.result=o})}function M(n,e){return te(async(t,r,s)=>{const{method:i}=t;if(i!==n)return s();if(!e)throw new Error(`WalletMiddleware - ${n} not provided`);const o=await e(t);r.result=o})}function It(n){const{getAccounts:e,requestAccounts:t,signTransaction:r,signAndSendTransaction:s,signAllTransactions:i,signMessage:o,getPrivateKey:d,getSecretKey:a}=n;return re([zr({requestAccounts:t}),Hr({getAccounts:e}),M("signTransaction",r),M("signAndSendTransaction",s),M("signAllTransactions",i),M("signMessage",o),M("solanaPrivateKey",d),M("private_key",d),M("solanaSecretKey",a)])}function Wr(n){let{addNewChainConfig:e,switchSolanaChain:t}=n;return re([M("addSolanaChain",e),M("switchSolanaChain",t)])}function Br(n){let{updatePrivatekey:e}=n;return re([M("updateAccount",e)])}function nt(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function Vr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nt(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):nt(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Gr(n){return te(async(e,t,r)=>{const s=await n.request(Vr({},e));t.result=s})}const Jr=n=>({requestAccounts:async()=>await n.request({method:"solana_requestAccounts",params:{}}),getAccounts:async()=>await n.request({method:"solana_requestAccounts",params:{}}),getPrivateKey:async()=>{throw p.ethErrors.rpc.methodNotSupported()},getSecretKey:async()=>{throw p.ethErrors.rpc.methodNotSupported()},signMessage:async t=>{var r;if(!((r=t.params)!==null&&r!==void 0&&r.message))throw p.ethErrors.rpc.invalidParams("message");return await n.signMessage(t.params.message)},signTransaction:async t=>{var r;if(!((r=t.params)!==null&&r!==void 0&&r.message))throw p.ethErrors.rpc.invalidParams("message");const s=t.params.message;return await n.signTransaction(s)},signAndSendTransaction:async t=>{var r;if(!((r=t.params)!==null&&r!==void 0&&r.message))throw p.ethErrors.rpc.invalidParams("message");const s=t.params.message;return{signature:await n.sendTransaction(s)}},signAllTransactions:async t=>{var r,s;if(!((r=t.params)!==null&&r!==void 0&&r.message)||!((s=t.params)!==null&&s!==void 0&&s.message.length))throw p.ethErrors.rpc.invalidParams("message");const i=t.params.message;return await n.signAllTransactions(i)}});function st(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function de(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?st(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):st(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class Yr extends At{constructor(e){let{config:t,state:r}=e;super({config:{chainConfig:de(de({},t.chainConfig),{},{chainNamespace:ue.SOLANA})},state:r})}async switchChain(e){await this.provider.request({method:"switchSolanaChain",params:[{chainId:e.chainId}]})}async addChain(e){super.addChain(e),await this.provider.request({method:"addNewChainConfig",params:[{chainId:e.chainId,chainName:e.displayName,rpcUrls:[e.rpcTarget],blockExplorerUrls:[e.blockExplorer],nativeCurrency:{name:e.tickerName,symbol:e.ticker,decimals:e.decimals||18}}]})}async setupProvider(e){this.handleInjectedProviderUpdate(e),await this.setupEngine(e)}async lookupNetwork(){if(!this.provider)throw p.ethErrors.provider.custom({message:"Torus solana provider is not initialized",code:4902});const{chainId:e}=this.config.chainConfig,t=await this.provider.request({method:"solana_chainId"}),r=Xe(t.toString())?t:`0x${parseInt(t,10).toString(16)}`;if(e!==r)throw y.rpcConnectionError(`Invalid network, net_version is: ${r}, expected: ${e}`);return this.update({chainId:r}),this.provider.emit("connect",{chainId:this.state.chainId}),this.provider.emit("chainChanged",this.state.chainId),this.state.chainId}async setupEngine(e){const t=Jr(e),r=It(t),s=Gr(e),i=new I;i.push(r),i.push(s);const o=Se(i);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async handleInjectedProviderUpdate(e){e.on("accountsChanged",async t=>{this.provider.emit("accountsChanged",t)}),e.on("chainChanged",async t=>{const r=Xe(t)?t:`0x${parseInt(t,10).toString(16)}`;this.configure({chainConfig:de(de({},this.config.chainConfig),{},{chainId:r})}),await this.setupProvider(e)})}}async function Zr(n){let{privKey:e,getProviderEngineProxy:t}=n;const r=()=>kt.fromSecretKey(O.from(e,"hex"));if(typeof e!="string")throw y.invalidParams("privKey must be a string");const s=r();return{requestAccounts:async()=>[s.publicKey.toBase58()],getAccounts:async()=>[s.publicKey.toBase58()],getPrivateKey:async()=>e,getSecretKey:async()=>xt.encode(s.secretKey),signTransaction:async o=>{var d;if(!((d=o.params)!==null&&d!==void 0&&d.message))throw p.ethErrors.rpc.invalidParams("message");const a=o.params.message;return a.version!==void 0||a instanceof ve?a.sign([s]):a.partialSign(s),a},signMessage:async o=>{var d;if(!((d=o.params)!==null&&d!==void 0&&d.message))throw p.ethErrors.rpc.invalidParams("message");return mt.sign.detached(o.params.message,s.secretKey)},signAndSendTransaction:async o=>{var d;if(!((d=o.params)!==null&&d!==void 0&&d.message))throw p.ethErrors.rpc.invalidParams("message");const a=t();if(!a)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const l=o.params.message;return l.version!==void 0||l instanceof ve?l.sign([s]):l.partialSign(s),{signature:await a.request({method:"sendTransaction",params:[O.from(l.serialize()).toString("base64"),{encoding:"base64",preflightCommitment:"confirmed"}]})}},signAllTransactions:async o=>{var d,a,l;if(!((d=o.params)!==null&&d!==void 0&&d.message)||!((a=o.params)!==null&&a!==void 0&&a.message.length))throw p.ethErrors.rpc.invalidParams("message");const h=(l=o.params)===null||l===void 0?void 0:l.message;for(const g of h||[]){const u=g;u.version!==void 0||u instanceof ve?u.sign([s]):u.partialSign(s)}return h}}}function it(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function ot(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?it(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):it(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class at extends At{constructor(e){let{config:t,state:r}=e;super({config:{chainConfig:ot(ot({},t.chainConfig),{},{chainNamespace:ue.SOLANA})},state:r})}async enable(){if(!this.state.privateKey)throw p.ethErrors.provider.custom({message:"Private key is not found in state, plz pass it in constructor state param",code:4902});return await this.setupProvider(this.state.privateKey),this._providerEngineProxy.request({method:"eth_accounts"})}getEd25519Key(e){return $r(e).sk.toString("hex")}async setupProvider(e){const t=await Zr({privKey:e,getProviderEngineProxy:this.getProviderEngineProxy.bind(this)}),r=It(t),s=new I,{networkMiddleware:i}=Fr(this.config.chainConfig);s.push(this.getChainSwitchMiddleware()),s.push(this.getAccountMiddleware()),s.push(r),s.push(i);const o=Se(s);this.updateProviderEngineProxy(o),await this.lookupNetwork()}async updateAccount(e){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});await this._providerEngineProxy.request({method:"solanaPrivateKey"})!==e.privateKey&&(await this.setupProvider(e.privateKey),this._providerEngineProxy.emit("accountsChanged",{accounts:await this._providerEngineProxy.request({method:"requestAccounts"})}))}async switchChain(e){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const t=this.getChainConfig(e.chainId);this.update({chainId:"loading"}),this.configure({chainConfig:t});const r=await this._providerEngineProxy.request({method:"solanaPrivateKey"});await this.setupProvider(r)}async lookupNetwork(){if(!this._providerEngineProxy)throw p.ethErrors.provider.custom({message:"Provider is not initialized",code:4902});const e=await this._providerEngineProxy.request({method:"getHealth",params:[]}),{chainConfig:t}=this.config;if(e!=="ok")throw y.rpcConnectionError(`Failed to lookup network for following rpc target: ${t.rpcTarget}`);return this.update({chainId:t.chainId}),this.state.chainId!==t.chainId&&(this.provider.emit("chainChanged",this.state.chainId),this.provider.emit("connect",{chainId:this.state.chainId})),this.state.chainId}getChainSwitchMiddleware(){return Wr({addNewChainConfig:async r=>{if(!r.params)throw p.ethErrors.rpc.invalidParams("Missing request params");const{chainId:s,chainName:i,rpcUrls:o,blockExplorerUrls:d,nativeCurrency:a}=r.params;if(!s)throw p.ethErrors.rpc.invalidParams("Missing chainId in chainParams");if(!o||o.length===0)throw p.ethErrors.rpc.invalidParams("Missing rpcUrls in chainParams");if(!a)throw p.ethErrors.rpc.invalidParams("Missing nativeCurrency in chainParams");this.addChain({chainNamespace:ue.SOLANA,chainId:s,ticker:a?.symbol||"SOL",tickerName:a?.name||"Solana",displayName:i,rpcTarget:o[0],blockExplorer:d?.[0]||"",decimals:a?.decimals||9})},switchSolanaChain:async r=>{if(!r.params)throw p.ethErrors.rpc.invalidParams("Missing request params");if(!r.params.chainId)throw p.ethErrors.rpc.invalidParams("Missing chainId");await this.switchChain(r.params)}})}getAccountMiddleware(){return Br({updatePrivatekey:async t=>{if(!t.params)throw p.ethErrors.rpc.invalidParams("Missing request params");if(!t.params.privateKey)throw p.ethErrors.rpc.invalidParams("Missing privateKey");const{privateKey:r}=t.params;await this.updateAccount({privateKey:r})}})}}c(at,"getProviderInstance",async n=>{const e=new at({config:{chainConfig:n.chainConfig}});return await e.setupProvider(n.privKey),e});function dt(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function ct(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dt(Object(t),!0).forEach(function(r){c(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):dt(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}class un extends Ht{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),c(this,"name",oe.TORUS_SOLANA),c(this,"adapterNamespace",xr.SOLANA),c(this,"currentChainNamespace",ue.SOLANA),c(this,"type",Lr.EXTERNAL),c(this,"status",j.NOT_READY),c(this,"torusInstance",null),c(this,"torusWalletOptions",void 0),c(this,"initParams",void 0),c(this,"loginSettings",{}),c(this,"solanaProvider",null),this.torusWalletOptions=e.adapterSettings||{},this.initParams=e.initParams||{},this.loginSettings=e.loginSettings||{}}get provider(){if(this.status===j.CONNECTED&&this.solanaProvider){var e;return((e=this.solanaProvider)===null||e===void 0?void 0:e.provider)||null}return null}set provider(e){throw new Error("Not implemented")}async init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};await super.init(e),super.checkInitializationRequirements();const{chainId:t,blockExplorer:r,displayName:s,rpcTarget:i,ticker:o,tickerName:d}=this.chainConfig,a={chainId:t,rpcTarget:i,blockExplorerUrl:r,displayName:s,tickerName:d,ticker:o,logo:""};this.torusInstance=new Pr(this.torusWalletOptions),Oe.debug("initializing torus solana adapter init"),await this.torusInstance.init(ct(ct({showTorusButton:!1},this.initParams),{},{network:a})),this.solanaProvider=new Yr({config:{chainConfig:this.chainConfig}}),this.status=j.READY,this.emit(ae.READY,oe.TORUS_SOLANA);try{Oe.debug("initializing torus solana adapter"),e.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(l){Oe.error("Failed to connect with cached torus solana provider",l),this.emit(ae.ERRORED,l)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance||!this.solanaProvider)throw y.notReady("Torus wallet is not initialized");this.status=j.CONNECTING,this.emit(ae.CONNECTING,{adapter:oe.TORUS_SOLANA});try{await this.torusInstance.login(this.loginSettings);try{const e=this.torusInstance.provider;e.sendTransaction=this.torusInstance.sendTransaction.bind(this.torusInstance),e.signAllTransactions=this.torusInstance.signAllTransactions.bind(this.torusInstance),e.signMessage=this.torusInstance.signMessage.bind(this.torusInstance),e.signTransaction=this.torusInstance.signTransaction.bind(this.torusInstance),await this.solanaProvider.setupProvider(e)}catch(e){if(e instanceof ee&&e.code===5010){const{chainId:t,blockExplorer:r,displayName:s,rpcTarget:i,ticker:o,tickerName:d}=this.chainConfig,a={chainId:t,rpcTarget:i,blockExplorerUrl:r,displayName:s,tickerName:d,ticker:o,logo:""};await this.torusInstance.setProvider(a)}else throw e}return this.status=j.CONNECTED,this.torusInstance.showTorusButton(),this.emit(j.CONNECTED,{adapter:oe.TORUS_SOLANA,reconnected:this.rehydrated}),this.provider}catch(e){throw this.status=j.READY,this.rehydrated=!1,this.emit(ae.ERRORED,e),e instanceof ee?e:b.connectionError("Failed to login with torus solana wallet")}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(await super.disconnectSession(),!this.torusInstance)throw y.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),e.cleanup?(this.status=j.NOT_READY,this.torusInstance=null,this.solanaProvider=null):this.status=j.READY,await super.disconnect()}async getUserInfo(){if(this.status!==j.CONNECTED)throw b.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw y.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo()}async addChain(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(t),this.addChainConfig(e)}async switchChain(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(e,r);const s=this.getChainConfig(e.chainId);await((t=this.torusInstance)===null||t===void 0?void 0:t.setProvider({rpcTarget:s.rpcTarget,chainId:s.chainId,displayName:s.displayName,blockExplorerUrl:s.blockExplorer,ticker:s.ticker,tickerName:s.tickerName,logo:"https://images.web3auth.io/login-torus-solana.svg"})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}}export{un as SolanaWalletAdapter};
