import{_ as Yr,r as zr,f as br,E as Pt,a as Je,b as g,o as Xr,e as Wt,p as Ge,s as Jr,c as Zr,d as Qr,g as _e,h as q,i as vr,j as Ze,k as Nt,l as Be,u as We,m as en,n as tn,q as Qe,t as _r,v as rn,B as It,w as nn,x as sn,y as an,C as on,z as dn,A as Er}from"./index-794d9b4b.js";import{i as un,d as ln}from"./index-8780f709.js";function cn(r,e){if(r==null)return{};var t=Yr(r,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}const hn=()=>zr(32).toString("hex");var ie={},ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.EthereumProviderError=ae.EthereumRpcError=void 0;const fn=br;let Cr=class extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string.');super(t),this.code=e,n!==void 0&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return fn.default(this.serialize(),mn,2)}};ae.EthereumRpcError=Cr;let pn=class extends Cr{constructor(e,t,n){if(!gn(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}};ae.EthereumProviderError=pn;function gn(r){return Number.isInteger(r)&&r>=1e3&&r<=4999}function mn(r,e){if(e!=="[Circular]")return e}var Mt={},oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.errorValues=oe.errorCodes=void 0;oe.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};oe.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.serializeError=r.isValidCode=r.getMessageFromCode=r.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=oe,t=ae,n=e.errorCodes.rpc.internal,i="Unspecified error message. This is a bug, please report it.",o={code:n,message:d(n)};r.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function d(p,S=i){if(Number.isInteger(p)){const R=p.toString();if(m(e.errorValues,R))return e.errorValues[R].message;if(v(p))return r.JSON_RPC_SERVER_ERROR_MESSAGE}return S}r.getMessageFromCode=d;function f(p){if(!Number.isInteger(p))return!1;const S=p.toString();return!!(e.errorValues[S]||v(p))}r.isValidCode=f;function h(p,{fallbackError:S=o,shouldIncludeStack:R=!1}={}){var O,j;if(!S||!Number.isInteger(S.code)||typeof S.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(p instanceof t.EthereumRpcError)return p.serialize();const l={};if(p&&typeof p=="object"&&!Array.isArray(p)&&m(p,"code")&&f(p.code)){const C=p;l.code=C.code,C.message&&typeof C.message=="string"?(l.message=C.message,m(C,"data")&&(l.data=C.data)):(l.message=d(l.code),l.data={originalError:_(p)})}else{l.code=S.code;const C=(O=p)===null||O===void 0?void 0:O.message;l.message=C&&typeof C=="string"?C:S.message,l.data={originalError:_(p)}}const w=(j=p)===null||j===void 0?void 0:j.stack;return R&&p&&w&&typeof w=="string"&&(l.stack=w),l}r.serializeError=h;function v(p){return p>=-32099&&p<=-32e3}function _(p){return p&&typeof p=="object"&&!Array.isArray(p)?Object.assign({},p):p}function m(p,S){return Object.prototype.hasOwnProperty.call(p,S)}})(Mt);var et={};Object.defineProperty(et,"__esModule",{value:!0});et.ethErrors=void 0;const Dt=ae,Sr=Mt,V=oe;et.ethErrors={rpc:{parse:r=>F(V.errorCodes.rpc.parse,r),invalidRequest:r=>F(V.errorCodes.rpc.invalidRequest,r),invalidParams:r=>F(V.errorCodes.rpc.invalidParams,r),methodNotFound:r=>F(V.errorCodes.rpc.methodNotFound,r),internal:r=>F(V.errorCodes.rpc.internal,r),server:r=>{if(!r||typeof r!="object"||Array.isArray(r))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=r;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return F(e,r)},invalidInput:r=>F(V.errorCodes.rpc.invalidInput,r),resourceNotFound:r=>F(V.errorCodes.rpc.resourceNotFound,r),resourceUnavailable:r=>F(V.errorCodes.rpc.resourceUnavailable,r),transactionRejected:r=>F(V.errorCodes.rpc.transactionRejected,r),methodNotSupported:r=>F(V.errorCodes.rpc.methodNotSupported,r),limitExceeded:r=>F(V.errorCodes.rpc.limitExceeded,r)},provider:{userRejectedRequest:r=>Pe(V.errorCodes.provider.userRejectedRequest,r),unauthorized:r=>Pe(V.errorCodes.provider.unauthorized,r),unsupportedMethod:r=>Pe(V.errorCodes.provider.unsupportedMethod,r),disconnected:r=>Pe(V.errorCodes.provider.disconnected,r),chainDisconnected:r=>Pe(V.errorCodes.provider.chainDisconnected,r),custom:r=>{if(!r||typeof r!="object"||Array.isArray(r))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:t,data:n}=r;if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string');return new Dt.EthereumProviderError(e,t,n)}}};function F(r,e){const[t,n]=Or(e);return new Dt.EthereumRpcError(r,t||Sr.getMessageFromCode(r),n)}function Pe(r,e){const[t,n]=Or(e);return new Dt.EthereumProviderError(r,t||Sr.getMessageFromCode(r),n)}function Or(r){if(r){if(typeof r=="string")return[r];if(typeof r=="object"&&!Array.isArray(r)){const{message:e,data:t}=r;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.getMessageFromCode=r.serializeError=r.EthereumProviderError=r.EthereumRpcError=r.ethErrors=r.errorCodes=void 0;const e=ae;Object.defineProperty(r,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(r,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const t=Mt;Object.defineProperty(r,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(r,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});const n=et;Object.defineProperty(r,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});const i=oe;Object.defineProperty(r,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})})(ie);function qe(){}const Ht="SYN",bt="ACK",Vt="BRK";class Kt extends Je.Duplex{constructor(e){let{name:t,target:n,targetWindow:i=window,targetOrigin:o="*"}=e;if(super({objectMode:!0}),g(this,"_init",void 0),g(this,"_haveSyn",void 0),g(this,"_name",void 0),g(this,"_target",void 0),g(this,"_targetWindow",void 0),g(this,"_targetOrigin",void 0),g(this,"_onMessage",void 0),g(this,"_synIntervalId",void 0),!t||!n)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=t,this._target=n,this._targetWindow=i,this._targetOrigin=o,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(Vt,null,qe),this._haveSyn=!1,this._init=!1}_handShake(){this._write(Ht,null,qe),this.cork()}_onData(e){if(!this._init)e===Ht?(this._haveSyn=!0,this._write(bt,null,qe)):e===bt&&(this._init=!0,this._haveSyn||this._write(bt,null,qe),this.uncork());else if(e===Vt)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,n){this._postMessage(e),n()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function qt(r,e,t){try{Reflect.apply(r,e,t)}catch(n){setTimeout(()=>{throw n})}}function wn(r){const e=r.length,t=new Array(e);for(let n=0;n<e;n+=1)t[n]=r[n];return t}let tt=class extends Pt{emit(e){let t=e==="error";const n=this._events;if(n!==void 0)t=t&&n.error===void 0;else if(!t)return!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),d=1;d<i;d++)o[d-1]=arguments[d];if(t){let h;if(o.length>0&&([h]=o),h instanceof Error)throw h;const v=new Error(`Unhandled error.${h?` (${h.message})`:""}`);throw v.context=h,v}const f=n[e];if(f===void 0)return!1;if(typeof f=="function")qt(f,this,o);else{const h=f.length,v=wn(f);for(let _=0;_<h;_+=1)qt(v[_],this,o)}return!0}};class Ne extends Error{constructor(e){let{code:t,message:n,data:i}=e;if(!Number.isInteger(t))throw new Error("code must be an integer");if(!n||typeof n!="string")throw new Error("message must be string");super(n),g(this,"code",void 0),g(this,"data",void 0),this.code=t,i!==void 0&&(this.data=i)}toString(){return Jr({code:this.code,message:this.message,data:this.data,stack:this.stack})}}function yn(){const r={};function e(){return!1}const t=new tt;function n(h){const v=r[h.id];if(!v)throw new Error(`StreamMiddleware - Unknown response id "${h.id}"`);delete r[h.id],Object.assign(v.res,h),setTimeout(v.end)}function i(h){t.emit("notification",h)}function o(h,v,_){let m;try{!h.id?i(h):n(h)}catch(p){m=p}_(m)}const d=new Je.Duplex({objectMode:!0,read:e,write:o});return{events:t,middleware:(h,v,_,m)=>{d.push(h),r[h.id]={req:h,res:v,next:_,end:m}},stream:d}}function bn(){return(r,e,t,n)=>{const i=r.id,o=hn();r.id=o,e.id=o,t(d=>{r.id=i,e.id=i,d()})}}function Ft(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function vn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ft(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ft(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class ne extends tt{constructor(){super(),g(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,t,n){const i=[];let o=null,d=!1;for(const f of n)if([o,d]=await ne._runMiddleware(e,t,f,i),d)break;return[o,d,i.reverse()]}static _runMiddleware(e,t,n,i){return new Promise(o=>{const d=h=>{const v=h||t.error;v&&(t.error=ie.serializeError(v)),o([v,!0])},f=h=>{t.error?d(t.error):(h&&(typeof h!="function"&&d(new Ne({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),i.push(h)),o([null,!1]))};try{n(e,t,f,d)}catch(h){d(h)}})}static async _runReturnHandlers(e){for(const t of e)await new Promise((n,i)=>{t(o=>o?i(o):n())})}static _checkForCompletion(e,t,n){if(!("result"in t)&&!("error"in t))throw new Ne({code:-32603,message:"Response has no error or result for request"});if(!n)throw new Ne({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?this._handleBatch(e,t):this._handleBatch(e):t?this._handle(e,t):this._promiseHandle(e)}asMiddleware(){return async(e,t,n,i)=>{try{const[o,d,f]=await ne._runAllMiddleware(e,t,this._middleware);return d?(await ne._runReturnHandlers(f),i(o)):n(async h=>{try{await ne._runReturnHandlers(f)}catch(v){return h(v)}return h()})}catch(o){return i(o)}}}async _handleBatch(e,t){try{const n=await Promise.all(e.map(this._promiseHandle.bind(this)));return t?t(null,n):n}catch(n){if(t)return t(n);throw n}}_promiseHandle(e){return new Promise(t=>{this._handle(e,(n,i)=>{t(i)})})}async _handle(e,t){if(!e||Array.isArray(e)||typeof e!="object"){const d=new Ne({code:-32603,message:"request must be plain object"});return t(d,{id:void 0,jsonrpc:"2.0",error:d})}if(typeof e.method!="string"){const d=new Ne({code:-32603,message:"method must be string"});return t(d,{id:e.id,jsonrpc:"2.0",error:d})}const n=vn({},e),i={id:n.id,jsonrpc:n.jsonrpc};let o=null;try{await this._processRequest(n,i)}catch(d){o=d}return o&&(delete i.result,i.error||(i.error=ie.serializeError(o))),t(o,i)}async _processRequest(e,t){const[n,i,o]=await ne._runAllMiddleware(e,t,this._middleware);if(ne._checkForCompletion(e,t,i),await ne._runReturnHandlers(o),n)throw n}}class _n extends Je.Duplex{constructor(e){let{parent:t,name:n}=e;super({objectMode:!0}),g(this,"_parent",void 0),g(this,"_name",void 0),this._parent=t,this._name=n}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}function $t(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Gt(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$t(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):$t(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const Yt=Symbol("IGNORE_SUBSTREAM");class Ar extends Je.Duplex{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(Gt(Gt({},e),{},{objectMode:!0})),g(this,"_substreams",void 0),g(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new _n({parent:this,name:e});return this._substreams[e]=t,En(this,n=>t.destroy(n||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Yt}_read(){}_write(e,t,n){const{name:i,data:o}=e;if(!i)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const d=this._substreams[i];return d?(d!==Yt&&d.push(o),n()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${i}"`),n())}}function En(r,e){const t=Xr(e);Wt(r,{readable:!1},t),Wt(r,{writable:!1},t)}function Cn(r){const e=new Ar;return e.getStream=function(n){return this._substreams[n]?this._substreams[n]:this.createStream(n)},Ge(r,e,r,t=>{t&&window.console.error(t)}),e}var At={},rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.storeAsStream=void 0;const Sn=Zr;class On extends Sn.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=t=>this.push(t),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const n=super.pipe(e,t);return e.write(this.obsStore.getState()),n}_write(e,t,n){this.obsStore.putState(e),n()}_read(e){}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}function An(r){return new On(r)}rt.storeAsStream=An;var nt={},Ae={},Tn=_e&&_e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.ObservableStore=void 0;const Rn=Tn(Qr);class Pn extends Rn.default{constructor(e){super(),e?this._state=e:this._state={}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&typeof e=="object"){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}Ae.ObservableStore=Pn;Object.defineProperty(nt,"__esModule",{value:!0});nt.ComposedStore=void 0;const Nn=Ae;class In extends Nn.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach(t=>{const n=this._children[t];this._addChild(t,n)})}_addChild(e,t){const n=i=>{const o=this.getState();o[e]=i,this.putState(o)};t.subscribe(n),n(t.getState())}}nt.ComposedStore=In;var it={};Object.defineProperty(it,"__esModule",{value:!0});it.MergedStore=void 0;const Mn=Ae;class Dn extends Mn.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach(t=>this._addChild(t)),this._updateWholeState()}_addChild(e){e.subscribe(()=>this._updateWholeState())}_updateWholeState(){const e=this._children.map(n=>n.getState()),t=Object.assign({},...e);this.putState(t)}}it.MergedStore=Dn;var st={},at={exports:{}},Tt={exports:{}},Rt={exports:{}};typeof q>"u"||!q.version||q.version.indexOf("v0.")===0||q.version.indexOf("v1.")===0&&q.version.indexOf("v1.8.")!==0?Rt.exports={nextTick:kn}:Rt.exports=q;function kn(r,e,t,n){if(typeof r!="function")throw new TypeError('"callback" argument must be a function');var i=arguments.length,o,d;switch(i){case 0:case 1:return q.nextTick(r);case 2:return q.nextTick(function(){r.call(null,e)});case 3:return q.nextTick(function(){r.call(null,e,t)});case 4:return q.nextTick(function(){r.call(null,e,t,n)});default:for(o=new Array(i-1),d=0;d<o.length;)o[d++]=arguments[d];return q.nextTick(function(){r.apply(null,o)})}}var ot=Rt.exports,xn={}.toString,Ln=Array.isArray||function(r){return xn.call(r)=="[object Array]"},Tr=vr.EventEmitter,vt={exports:{}},zt;function Un(){return zt||(zt=1,function(r){function e(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")}var t=Ze.Buffer,n=Nt;function i(o,d,f){o.copy(d,f)}r.exports=function(){function o(){e(this,o),this.head=null,this.tail=null,this.length=0}return o.prototype.push=function(f){var h={data:f,next:null};this.length>0?this.tail.next=h:this.head=h,this.tail=h,++this.length},o.prototype.unshift=function(f){var h={data:f,next:this.head};this.length===0&&(this.tail=h),this.head=h,++this.length},o.prototype.shift=function(){if(this.length!==0){var f=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,f}},o.prototype.clear=function(){this.head=this.tail=null,this.length=0},o.prototype.join=function(f){if(this.length===0)return"";for(var h=this.head,v=""+h.data;h=h.next;)v+=f+h.data;return v},o.prototype.concat=function(f){if(this.length===0)return t.alloc(0);for(var h=t.allocUnsafe(f>>>0),v=this.head,_=0;v;)i(v.data,h,_),_+=v.data.length,v=v.next;return h},o}(),n&&n.inspect&&n.inspect.custom&&(r.exports.prototype[n.inspect.custom]=function(){var o=n.inspect({length:this.length});return this.constructor.name+" "+o})}(vt)),vt.exports}var Fe=ot;function jn(r,e){var t=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Fe.nextTick($e,this,r)):Fe.nextTick($e,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(o){!e&&o?t._writableState?t._writableState.errorEmitted||(t._writableState.errorEmitted=!0,Fe.nextTick($e,t,o)):Fe.nextTick($e,t,o):e&&e(o)}),this)}function Bn(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function $e(r,e){r.emit("error",e)}var Rr={destroy:jn,undestroy:Bn},_t,Xt;function Pr(){if(Xt)return _t;Xt=1;var r=ot;_t=O;function e(u){var c=this;this.next=null,this.entry=null,this.finish=function(){ft(c,u)}}var t=!q.browser&&["v0.10","v0.9."].indexOf(q.version.slice(0,5))>-1?setImmediate:r.nextTick,n;O.WritableState=S;var i=Object.create(We);i.inherits=Be;var o={deprecate:en},d=Tr,f=Ze.Buffer,h=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function v(u){return f.from(u)}function _(u){return f.isBuffer(u)||u instanceof h}var m=Rr;i.inherits(O,d);function p(){}function S(u,c){n=n||Se(),u=u||{};var b=c instanceof n;this.objectMode=!!u.objectMode,b&&(this.objectMode=this.objectMode||!!u.writableObjectMode);var A=u.highWaterMark,N=u.writableHighWaterMark,M=this.objectMode?16:16*1024;A||A===0?this.highWaterMark=A:b&&(N||N===0)?this.highWaterMark=N:this.highWaterMark=M,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Y=u.decodeStrings===!1;this.decodeStrings=!Y,this.defaultEncoding=u.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(z){te(c,z)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}S.prototype.getBuffer=function(){for(var c=this.bufferedRequest,b=[];c;)b.push(c),c=c.next;return b},function(){try{Object.defineProperty(S.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var R;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(R=Function.prototype[Symbol.hasInstance],Object.defineProperty(O,Symbol.hasInstance,{value:function(u){return R.call(this,u)?!0:this!==O?!1:u&&u._writableState instanceof S}})):R=function(u){return u instanceof this};function O(u){if(n=n||Se(),!R.call(O,this)&&!(this instanceof n))return new O(u);this._writableState=new S(u,this),this.writable=!0,u&&(typeof u.write=="function"&&(this._write=u.write),typeof u.writev=="function"&&(this._writev=u.writev),typeof u.destroy=="function"&&(this._destroy=u.destroy),typeof u.final=="function"&&(this._final=u.final)),d.call(this)}O.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function j(u,c){var b=new Error("write after end");u.emit("error",b),r.nextTick(c,b)}function l(u,c,b,A){var N=!0,M=!1;return b===null?M=new TypeError("May not write null values to stream"):typeof b!="string"&&b!==void 0&&!c.objectMode&&(M=new TypeError("Invalid non-string/buffer chunk")),M&&(u.emit("error",M),r.nextTick(A,M),N=!1),N}O.prototype.write=function(u,c,b){var A=this._writableState,N=!1,M=!A.objectMode&&_(u);return M&&!f.isBuffer(u)&&(u=v(u)),typeof c=="function"&&(b=c,c=null),M?c="buffer":c||(c=A.defaultEncoding),typeof b!="function"&&(b=p),A.ended?j(this,b):(M||l(this,A,u,b))&&(A.pendingcb++,N=C(this,A,M,u,c,b)),N},O.prototype.cork=function(){var u=this._writableState;u.corked++},O.prototype.uncork=function(){var u=this._writableState;u.corked&&(u.corked--,!u.writing&&!u.corked&&!u.bufferProcessing&&u.bufferedRequest&&ye(this,u))},O.prototype.setDefaultEncoding=function(c){if(typeof c=="string"&&(c=c.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((c+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+c);return this._writableState.defaultEncoding=c,this};function w(u,c,b){return!u.objectMode&&u.decodeStrings!==!1&&typeof c=="string"&&(c=f.from(c,b)),c}Object.defineProperty(O.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function C(u,c,b,A,N,M){if(!b){var Y=w(c,A,N);A!==Y&&(b=!0,N="buffer",A=Y)}var z=c.objectMode?1:A.length;c.length+=z;var ce=c.length<c.highWaterMark;if(ce||(c.needDrain=!0),c.writing||c.corked){var he=c.lastBufferedRequest;c.lastBufferedRequest={chunk:A,encoding:N,isBuf:b,callback:M,next:null},he?he.next=c.lastBufferedRequest:c.bufferedRequest=c.lastBufferedRequest,c.bufferedRequestCount+=1}else L(u,c,!1,z,A,N,M);return ce}function L(u,c,b,A,N,M,Y){c.writelen=A,c.writecb=Y,c.writing=!0,c.sync=!0,b?u._writev(N,c.onwrite):u._write(N,M,c.onwrite),c.sync=!1}function x(u,c,b,A,N){--c.pendingcb,b?(r.nextTick(N,A),r.nextTick(le,u,c),u._writableState.errorEmitted=!0,u.emit("error",A)):(N(A),u._writableState.errorEmitted=!0,u.emit("error",A),le(u,c))}function ee(u){u.writing=!1,u.writecb=null,u.length-=u.writelen,u.writelen=0}function te(u,c){var b=u._writableState,A=b.sync,N=b.writecb;if(ee(b),c)x(u,b,A,c,N);else{var M=J(b);!M&&!b.corked&&!b.bufferProcessing&&b.bufferedRequest&&ye(u,b),A?t(re,u,b,M,N):re(u,b,M,N)}}function re(u,c,b,A){b||we(u,c),c.pendingcb--,A(),le(u,c)}function we(u,c){c.length===0&&c.needDrain&&(c.needDrain=!1,u.emit("drain"))}function ye(u,c){c.bufferProcessing=!0;var b=c.bufferedRequest;if(u._writev&&b&&b.next){var A=c.bufferedRequestCount,N=new Array(A),M=c.corkedRequestsFree;M.entry=b;for(var Y=0,z=!0;b;)N[Y]=b,b.isBuf||(z=!1),b=b.next,Y+=1;N.allBuffers=z,L(u,c,!0,c.length,N,"",M.finish),c.pendingcb++,c.lastBufferedRequest=null,M.next?(c.corkedRequestsFree=M.next,M.next=null):c.corkedRequestsFree=new e(c),c.bufferedRequestCount=0}else{for(;b;){var ce=b.chunk,he=b.encoding,s=b.callback,a=c.objectMode?1:ce.length;if(L(u,c,!1,a,ce,he,s),b=b.next,c.bufferedRequestCount--,c.writing)break}b===null&&(c.lastBufferedRequest=null)}c.bufferedRequest=b,c.bufferProcessing=!1}O.prototype._write=function(u,c,b){b(new Error("_write() is not implemented"))},O.prototype._writev=null,O.prototype.end=function(u,c,b){var A=this._writableState;typeof u=="function"?(b=u,u=null,c=null):typeof c=="function"&&(b=c,c=null),u!=null&&this.write(u,c),A.corked&&(A.corked=1,this.uncork()),A.ending||ht(this,A,b)};function J(u){return u.ending&&u.length===0&&u.bufferedRequest===null&&!u.finished&&!u.writing}function He(u,c){u._final(function(b){c.pendingcb--,b&&u.emit("error",b),c.prefinished=!0,u.emit("prefinish"),le(u,c)})}function Ve(u,c){!c.prefinished&&!c.finalCalled&&(typeof u._final=="function"?(c.pendingcb++,c.finalCalled=!0,r.nextTick(He,u,c)):(c.prefinished=!0,u.emit("prefinish")))}function le(u,c){var b=J(c);return b&&(Ve(u,c),c.pendingcb===0&&(c.finished=!0,u.emit("finish"))),b}function ht(u,c,b){c.ending=!0,le(u,c),b&&(c.finished?r.nextTick(b):u.once("finish",b)),c.ended=!0,u.writable=!1}function ft(u,c,b){var A=u.entry;for(u.entry=null;A;){var N=A.callback;c.pendingcb--,N(b),A=A.next}c.corkedRequestsFree.next=u}return Object.defineProperty(O.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(u){this._writableState&&(this._writableState.destroyed=u)}}),O.prototype.destroy=m.destroy,O.prototype._undestroy=m.undestroy,O.prototype._destroy=function(u,c){this.end(),c(u)},_t}var Et,Jt;function Se(){if(Jt)return Et;Jt=1;var r=ot,e=Object.keys||function(m){var p=[];for(var S in m)p.push(S);return p};Et=h;var t=Object.create(We);t.inherits=Be;var n=Nr(),i=Pr();t.inherits(h,n);for(var o=e(i.prototype),d=0;d<o.length;d++){var f=o[d];h.prototype[f]||(h.prototype[f]=i.prototype[f])}function h(m){if(!(this instanceof h))return new h(m);n.call(this,m),i.call(this,m),m&&m.readable===!1&&(this.readable=!1),m&&m.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,m&&m.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",v)}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function v(){this.allowHalfOpen||this._writableState.ended||r.nextTick(_,this)}function _(m){m.end()}return Object.defineProperty(h.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(m){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=m,this._writableState.destroyed=m)}}),h.prototype._destroy=function(m,p){this.push(null),this.end(),r.nextTick(p,m)},Et}var Ct={},Zt;function Qt(){if(Zt)return Ct;Zt=1;var r=Ze.Buffer,e=r.isEncoding||function(l){switch(l=""+l,l&&l.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(l){if(!l)return"utf8";for(var w;;)switch(l){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return l;default:if(w)return;l=(""+l).toLowerCase(),w=!0}}function n(l){var w=t(l);if(typeof w!="string"&&(r.isEncoding===e||!e(l)))throw new Error("Unknown encoding: "+l);return w||l}Ct.StringDecoder=i;function i(l){this.encoding=n(l);var w;switch(this.encoding){case"utf16le":this.text=m,this.end=p,w=4;break;case"utf8":this.fillLast=h,w=4;break;case"base64":this.text=S,this.end=R,w=3;break;default:this.write=O,this.end=j;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(w)}i.prototype.write=function(l){if(l.length===0)return"";var w,C;if(this.lastNeed){if(w=this.fillLast(l),w===void 0)return"";C=this.lastNeed,this.lastNeed=0}else C=0;return C<l.length?w?w+this.text(l,C):this.text(l,C):w||""},i.prototype.end=_,i.prototype.text=v,i.prototype.fillLast=function(l){if(this.lastNeed<=l.length)return l.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);l.copy(this.lastChar,this.lastTotal-this.lastNeed,0,l.length),this.lastNeed-=l.length};function o(l){return l<=127?0:l>>5===6?2:l>>4===14?3:l>>3===30?4:l>>6===2?-1:-2}function d(l,w,C){var L=w.length-1;if(L<C)return 0;var x=o(w[L]);return x>=0?(x>0&&(l.lastNeed=x-1),x):--L<C||x===-2?0:(x=o(w[L]),x>=0?(x>0&&(l.lastNeed=x-2),x):--L<C||x===-2?0:(x=o(w[L]),x>=0?(x>0&&(x===2?x=0:l.lastNeed=x-3),x):0))}function f(l,w,C){if((w[0]&192)!==128)return l.lastNeed=0,"�";if(l.lastNeed>1&&w.length>1){if((w[1]&192)!==128)return l.lastNeed=1,"�";if(l.lastNeed>2&&w.length>2&&(w[2]&192)!==128)return l.lastNeed=2,"�"}}function h(l){var w=this.lastTotal-this.lastNeed,C=f(this,l);if(C!==void 0)return C;if(this.lastNeed<=l.length)return l.copy(this.lastChar,w,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);l.copy(this.lastChar,w,0,l.length),this.lastNeed-=l.length}function v(l,w){var C=d(this,l,w);if(!this.lastNeed)return l.toString("utf8",w);this.lastTotal=C;var L=l.length-(C-this.lastNeed);return l.copy(this.lastChar,0,L),l.toString("utf8",w,L)}function _(l){var w=l&&l.length?this.write(l):"";return this.lastNeed?w+"�":w}function m(l,w){if((l.length-w)%2===0){var C=l.toString("utf16le",w);if(C){var L=C.charCodeAt(C.length-1);if(L>=55296&&L<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=l[l.length-2],this.lastChar[1]=l[l.length-1],C.slice(0,-1)}return C}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=l[l.length-1],l.toString("utf16le",w,l.length-1)}function p(l){var w=l&&l.length?this.write(l):"";if(this.lastNeed){var C=this.lastTotal-this.lastNeed;return w+this.lastChar.toString("utf16le",0,C)}return w}function S(l,w){var C=(l.length-w)%3;return C===0?l.toString("base64",w):(this.lastNeed=3-C,this.lastTotal=3,C===1?this.lastChar[0]=l[l.length-1]:(this.lastChar[0]=l[l.length-2],this.lastChar[1]=l[l.length-1]),l.toString("base64",w,l.length-C))}function R(l){var w=l&&l.length?this.write(l):"";return this.lastNeed?w+this.lastChar.toString("base64",0,3-this.lastNeed):w}function O(l){return l.toString(this.encoding)}function j(l){return l&&l.length?this.write(l):""}return Ct}var St,er;function Nr(){if(er)return St;er=1;var r=ot;St=w;var e=Ln,t;w.ReadableState=l,vr.EventEmitter;var n=function(s,a){return s.listeners(a).length},i=Tr,o=Ze.Buffer,d=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function f(s){return o.from(s)}function h(s){return o.isBuffer(s)||s instanceof d}var v=Object.create(We);v.inherits=Be;var _=Nt,m=void 0;_&&_.debuglog?m=_.debuglog("stream"):m=function(){};var p=Un(),S=Rr,R;v.inherits(w,i);var O=["error","close","destroy","pause","resume"];function j(s,a,y){if(typeof s.prependListener=="function")return s.prependListener(a,y);!s._events||!s._events[a]?s.on(a,y):e(s._events[a])?s._events[a].unshift(y):s._events[a]=[y,s._events[a]]}function l(s,a){t=t||Se(),s=s||{};var y=a instanceof t;this.objectMode=!!s.objectMode,y&&(this.objectMode=this.objectMode||!!s.readableObjectMode);var E=s.highWaterMark,I=s.readableHighWaterMark,T=this.objectMode?16:16*1024;E||E===0?this.highWaterMark=E:y&&(I||I===0)?this.highWaterMark=I:this.highWaterMark=T,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=s.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,s.encoding&&(R||(R=Qt().StringDecoder),this.decoder=new R(s.encoding),this.encoding=s.encoding)}function w(s){if(t=t||Se(),!(this instanceof w))return new w(s);this._readableState=new l(s,this),this.readable=!0,s&&(typeof s.read=="function"&&(this._read=s.read),typeof s.destroy=="function"&&(this._destroy=s.destroy)),i.call(this)}Object.defineProperty(w.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(s){this._readableState&&(this._readableState.destroyed=s)}}),w.prototype.destroy=S.destroy,w.prototype._undestroy=S.undestroy,w.prototype._destroy=function(s,a){this.push(null),a(s)},w.prototype.push=function(s,a){var y=this._readableState,E;return y.objectMode?E=!0:typeof s=="string"&&(a=a||y.defaultEncoding,a!==y.encoding&&(s=o.from(s,a),a=""),E=!0),C(this,s,a,!1,E)},w.prototype.unshift=function(s){return C(this,s,null,!0,!1)};function C(s,a,y,E,I){var T=s._readableState;if(a===null)T.reading=!1,ye(s,T);else{var P;I||(P=x(T,a)),P?s.emit("error",P):T.objectMode||a&&a.length>0?(typeof a!="string"&&!T.objectMode&&Object.getPrototypeOf(a)!==o.prototype&&(a=f(a)),E?T.endEmitted?s.emit("error",new Error("stream.unshift() after end event")):L(s,T,a,!0):T.ended?s.emit("error",new Error("stream.push() after EOF")):(T.reading=!1,T.decoder&&!y?(a=T.decoder.write(a),T.objectMode||a.length!==0?L(s,T,a,!1):Ve(s,T)):L(s,T,a,!1))):E||(T.reading=!1)}return ee(T)}function L(s,a,y,E){a.flowing&&a.length===0&&!a.sync?(s.emit("data",y),s.read(0)):(a.length+=a.objectMode?1:y.length,E?a.buffer.unshift(y):a.buffer.push(y),a.needReadable&&J(s)),Ve(s,a)}function x(s,a){var y;return!h(a)&&typeof a!="string"&&a!==void 0&&!s.objectMode&&(y=new TypeError("Invalid non-string/buffer chunk")),y}function ee(s){return!s.ended&&(s.needReadable||s.length<s.highWaterMark||s.length===0)}w.prototype.isPaused=function(){return this._readableState.flowing===!1},w.prototype.setEncoding=function(s){return R||(R=Qt().StringDecoder),this._readableState.decoder=new R(s),this._readableState.encoding=s,this};var te=8388608;function re(s){return s>=te?s=te:(s--,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s++),s}function we(s,a){return s<=0||a.length===0&&a.ended?0:a.objectMode?1:s!==s?a.flowing&&a.length?a.buffer.head.data.length:a.length:(s>a.highWaterMark&&(a.highWaterMark=re(s)),s<=a.length?s:a.ended?a.length:(a.needReadable=!0,0))}w.prototype.read=function(s){m("read",s),s=parseInt(s,10);var a=this._readableState,y=s;if(s!==0&&(a.emittedReadable=!1),s===0&&a.needReadable&&(a.length>=a.highWaterMark||a.ended))return m("read: emitReadable",a.length,a.ended),a.length===0&&a.ended?z(this):J(this),null;if(s=we(s,a),s===0&&a.ended)return a.length===0&&z(this),null;var E=a.needReadable;m("need readable",E),(a.length===0||a.length-s<a.highWaterMark)&&(E=!0,m("length less than watermark",E)),a.ended||a.reading?(E=!1,m("reading or ended",E)):E&&(m("do read"),a.reading=!0,a.sync=!0,a.length===0&&(a.needReadable=!0),this._read(a.highWaterMark),a.sync=!1,a.reading||(s=we(y,a)));var I;return s>0?I=A(s,a):I=null,I===null?(a.needReadable=!0,s=0):a.length-=s,a.length===0&&(a.ended||(a.needReadable=!0),y!==s&&a.ended&&z(this)),I!==null&&this.emit("data",I),I};function ye(s,a){if(!a.ended){if(a.decoder){var y=a.decoder.end();y&&y.length&&(a.buffer.push(y),a.length+=a.objectMode?1:y.length)}a.ended=!0,J(s)}}function J(s){var a=s._readableState;a.needReadable=!1,a.emittedReadable||(m("emitReadable",a.flowing),a.emittedReadable=!0,a.sync?r.nextTick(He,s):He(s))}function He(s){m("emit readable"),s.emit("readable"),b(s)}function Ve(s,a){a.readingMore||(a.readingMore=!0,r.nextTick(le,s,a))}function le(s,a){for(var y=a.length;!a.reading&&!a.flowing&&!a.ended&&a.length<a.highWaterMark&&(m("maybeReadMore read 0"),s.read(0),y!==a.length);)y=a.length;a.readingMore=!1}w.prototype._read=function(s){this.emit("error",new Error("_read() is not implemented"))},w.prototype.pipe=function(s,a){var y=this,E=this._readableState;switch(E.pipesCount){case 0:E.pipes=s;break;case 1:E.pipes=[E.pipes,s];break;default:E.pipes.push(s);break}E.pipesCount+=1,m("pipe count=%d opts=%j",E.pipesCount,a);var I=(!a||a.end!==!1)&&s!==q.stdout&&s!==q.stderr,T=I?Ke:Te;E.endEmitted?r.nextTick(T):y.once("end",T),s.on("unpipe",P);function P(be,Re){m("onunpipe"),be===y&&Re&&Re.hasUnpiped===!1&&(Re.hasUnpiped=!0,Gr())}function Ke(){m("onend"),s.end()}var pt=ht(y);s.on("drain",pt);var jt=!1;function Gr(){m("cleanup"),s.removeListener("close",wt),s.removeListener("finish",yt),s.removeListener("drain",pt),s.removeListener("error",mt),s.removeListener("unpipe",P),y.removeListener("end",Ke),y.removeListener("end",Te),y.removeListener("data",Bt),jt=!0,E.awaitDrain&&(!s._writableState||s._writableState.needDrain)&&pt()}var gt=!1;y.on("data",Bt);function Bt(be){m("ondata"),gt=!1;var Re=s.write(be);Re===!1&&!gt&&((E.pipesCount===1&&E.pipes===s||E.pipesCount>1&&he(E.pipes,s)!==-1)&&!jt&&(m("false write response, pause",E.awaitDrain),E.awaitDrain++,gt=!0),y.pause())}function mt(be){m("onerror",be),Te(),s.removeListener("error",mt),n(s,"error")===0&&s.emit("error",be)}j(s,"error",mt);function wt(){s.removeListener("finish",yt),Te()}s.once("close",wt);function yt(){m("onfinish"),s.removeListener("close",wt),Te()}s.once("finish",yt);function Te(){m("unpipe"),y.unpipe(s)}return s.emit("pipe",y),E.flowing||(m("pipe resume"),y.resume()),s};function ht(s){return function(){var a=s._readableState;m("pipeOnDrain",a.awaitDrain),a.awaitDrain&&a.awaitDrain--,a.awaitDrain===0&&n(s,"data")&&(a.flowing=!0,b(s))}}w.prototype.unpipe=function(s){var a=this._readableState,y={hasUnpiped:!1};if(a.pipesCount===0)return this;if(a.pipesCount===1)return s&&s!==a.pipes?this:(s||(s=a.pipes),a.pipes=null,a.pipesCount=0,a.flowing=!1,s&&s.emit("unpipe",this,y),this);if(!s){var E=a.pipes,I=a.pipesCount;a.pipes=null,a.pipesCount=0,a.flowing=!1;for(var T=0;T<I;T++)E[T].emit("unpipe",this,{hasUnpiped:!1});return this}var P=he(a.pipes,s);return P===-1?this:(a.pipes.splice(P,1),a.pipesCount-=1,a.pipesCount===1&&(a.pipes=a.pipes[0]),s.emit("unpipe",this,y),this)},w.prototype.on=function(s,a){var y=i.prototype.on.call(this,s,a);if(s==="data")this._readableState.flowing!==!1&&this.resume();else if(s==="readable"){var E=this._readableState;!E.endEmitted&&!E.readableListening&&(E.readableListening=E.needReadable=!0,E.emittedReadable=!1,E.reading?E.length&&J(this):r.nextTick(ft,this))}return y},w.prototype.addListener=w.prototype.on;function ft(s){m("readable nexttick read 0"),s.read(0)}w.prototype.resume=function(){var s=this._readableState;return s.flowing||(m("resume"),s.flowing=!0,u(this,s)),this};function u(s,a){a.resumeScheduled||(a.resumeScheduled=!0,r.nextTick(c,s,a))}function c(s,a){a.reading||(m("resume read 0"),s.read(0)),a.resumeScheduled=!1,a.awaitDrain=0,s.emit("resume"),b(s),a.flowing&&!a.reading&&s.read(0)}w.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function b(s){var a=s._readableState;for(m("flow",a.flowing);a.flowing&&s.read()!==null;);}w.prototype.wrap=function(s){var a=this,y=this._readableState,E=!1;s.on("end",function(){if(m("wrapped end"),y.decoder&&!y.ended){var P=y.decoder.end();P&&P.length&&a.push(P)}a.push(null)}),s.on("data",function(P){if(m("wrapped data"),y.decoder&&(P=y.decoder.write(P)),!(y.objectMode&&P==null)&&!(!y.objectMode&&(!P||!P.length))){var Ke=a.push(P);Ke||(E=!0,s.pause())}});for(var I in s)this[I]===void 0&&typeof s[I]=="function"&&(this[I]=function(P){return function(){return s[P].apply(s,arguments)}}(I));for(var T=0;T<O.length;T++)s.on(O[T],this.emit.bind(this,O[T]));return this._read=function(P){m("wrapped _read",P),E&&(E=!1,s.resume())},this},Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),w._fromList=A;function A(s,a){if(a.length===0)return null;var y;return a.objectMode?y=a.buffer.shift():!s||s>=a.length?(a.decoder?y=a.buffer.join(""):a.buffer.length===1?y=a.buffer.head.data:y=a.buffer.concat(a.length),a.buffer.clear()):y=N(s,a.buffer,a.decoder),y}function N(s,a,y){var E;return s<a.head.data.length?(E=a.head.data.slice(0,s),a.head.data=a.head.data.slice(s)):s===a.head.data.length?E=a.shift():E=y?M(s,a):Y(s,a),E}function M(s,a){var y=a.head,E=1,I=y.data;for(s-=I.length;y=y.next;){var T=y.data,P=s>T.length?T.length:s;if(P===T.length?I+=T:I+=T.slice(0,s),s-=P,s===0){P===T.length?(++E,y.next?a.head=y.next:a.head=a.tail=null):(a.head=y,y.data=T.slice(P));break}++E}return a.length-=E,I}function Y(s,a){var y=o.allocUnsafe(s),E=a.head,I=1;for(E.data.copy(y),s-=E.data.length;E=E.next;){var T=E.data,P=s>T.length?T.length:s;if(T.copy(y,y.length-s,0,P),s-=P,s===0){P===T.length?(++I,E.next?a.head=E.next:a.head=a.tail=null):(a.head=E,E.data=T.slice(P));break}++I}return a.length-=I,y}function z(s){var a=s._readableState;if(a.length>0)throw new Error('"endReadable()" called on non-empty stream');a.endEmitted||(a.ended=!0,r.nextTick(ce,a,s))}function ce(s,a){!s.endEmitted&&s.length===0&&(s.endEmitted=!0,a.readable=!1,a.emit("end"))}function he(s,a){for(var y=0,E=s.length;y<E;y++)if(s[y]===a)return y;return-1}return St}var Ir=se,dt=Se(),Mr=Object.create(We);Mr.inherits=Be;Mr.inherits(se,dt);function Wn(r,e){var t=this._transformState;t.transforming=!1;var n=t.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));t.writechunk=null,t.writecb=null,e!=null&&this.push(e),n(r);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function se(r){if(!(this instanceof se))return new se(r);dt.call(this,r),this._transformState={afterTransform:Wn.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",Hn)}function Hn(){var r=this;typeof this._flush=="function"?this._flush(function(e,t){tr(r,e,t)}):tr(this,null,null)}se.prototype.push=function(r,e){return this._transformState.needTransform=!1,dt.prototype.push.call(this,r,e)};se.prototype._transform=function(r,e,t){throw new Error("_transform() is not implemented")};se.prototype._write=function(r,e,t){var n=this._transformState;if(n.writecb=t,n.writechunk=r,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};se.prototype._read=function(r){var e=this._transformState;e.writechunk!==null&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};se.prototype._destroy=function(r,e){var t=this;dt.prototype._destroy.call(this,r,function(n){e(n),t.emit("close")})};function tr(r,e,t){if(e)return r.emit("error",e);if(t!=null&&r.push(t),r._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(r._transformState.transforming)throw new Error("Calling transform done when still transforming");return r.push(null)}var Vn=je,Dr=Ir,kr=Object.create(We);kr.inherits=Be;kr.inherits(je,Dr);function je(r){if(!(this instanceof je))return new je(r);Dr.call(this,r)}je.prototype._transform=function(r,e,t){t(null,r)};(function(r,e){e=r.exports=Nr(),e.Stream=e,e.Readable=e,e.Writable=Pr(),e.Duplex=Se(),e.Transform=Ir,e.PassThrough=Vn})(Tt,Tt.exports);var Kn=Tt.exports,xr=Kn.Transform,Lr=Nt.inherits,Ur=tn;function Oe(r){xr.call(this,r),this._destroyed=!1}Lr(Oe,xr);Oe.prototype.destroy=function(r){if(!this._destroyed){this._destroyed=!0;var e=this;q.nextTick(function(){r&&e.emit("error",r),e.emit("close")})}};function qn(r,e,t){t(null,r)}function kt(r){return function(e,t,n){return typeof e=="function"&&(n=t,t=e,e={}),typeof t!="function"&&(t=qn),typeof n!="function"&&(n=null),r(e,t,n)}}at.exports=kt(function(r,e,t){var n=new Oe(r);return n._transform=e,t&&(n._flush=t),n});at.exports.ctor=kt(function(r,e,t){function n(i){if(!(this instanceof n))return new n(i);this.options=Ur(r,i),Oe.call(this,this.options)}return Lr(n,Oe),n.prototype._transform=e,t&&(n.prototype._flush=t),n});at.exports.obj=kt(function(r,e,t){var n=new Oe(Ur({objectMode:!0,highWaterMark:16},r));return n._transform=e,t&&(n._flush=t),n});var Fn=at.exports;Object.defineProperty(st,"__esModule",{value:!0});st.storeTransformStream=void 0;const $n=Fn;function Gn(r){return $n.obj((e,t,n)=>{try{const i=r(e);n(null,i);return}catch(i){n(i);return}})}st.storeTransformStream=Gn;(function(r){var e=_e&&_e.__createBinding||(Object.create?function(n,i,o,d){d===void 0&&(d=o),Object.defineProperty(n,d,{enumerable:!0,get:function(){return i[o]}})}:function(n,i,o,d){d===void 0&&(d=o),n[d]=i[o]}),t=_e&&_e.__exportStar||function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&e(i,n,o)};Object.defineProperty(r,"__esModule",{value:!0}),t(rt,r),t(nt,r),t(it,r),t(Ae,r),t(st,r)})(At);const Ie={GOOGLE:"google",FACEBOOK:"facebook",TWITCH:"twitch",REDDIT:"reddit",DISCORD:"discord"},pe={GOOGLE:"google",FACEBOOK:"facebook",TWITCH:"twitch",REDDIT:"reddit",DISCORD:"discord",EMAIL_PASSWORDLESS:"torus-auth0-email-passwordless"},rr={[pe.GOOGLE]:"tkey-google",[pe.FACEBOOK]:"tkey-facebook",[pe.TWITCH]:"tkey-twitch",[pe.REDDIT]:"tkey-reddit",[pe.DISCORD]:"tkey-discord",[pe.EMAIL_PASSWORDLESS]:"tkey-auth0-email-passwordless"},B={MOONPAY:"moonpay",WYRE:"wyre",RAMPNETWORK:"rampnetwork",XANPOOL:"xanpool",MERCURYO:"mercuryo",TRANSAK:"transak",BANXA:"banxa"},H={MAINNET:"mainnet",MATIC:"matic",BSC_MAINNET:"bsc_mainnet",AVALANCHE_MAINNET:"avalanche_mainnet",XDAI:"xdai"},Yn={PRODUCTION:"production",DEVELOPMENT:"development",BINANCE:"binance",TESTING:"testing",LRC:"lrc",BETA:"beta",BNB:"bnb",POLYGON:"polygon"},ve={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},zn=["ETH","USDT","USDC","TUSD","EOSDT","USD","DAI","GUSD","DKKT","PAX","ILS","RUB","BYN","EUR","GBP","JPY","KRW","PLN","MXN","AUD","BRL","CAD","CHF","KPW","LAK","LBP","LKR","XOF","CNHT","DOGE","UAH","TRY","HKD","XJP","SGD","USC","NZD","NGN","RUR","COP","GHS","EGP","IDR","BHD","CRC","PEN","AED","DOP","PKR","HUF","VND","XAR","LTC","RON","OMR","MYR","DKK","UGX","ZMW","SAR","SEK","GEL","RWF","IRR","TZS","CNY","VEF","BDT","HRK","CLP","THB","XAF","ARS","UYU","SZL","KZT","NOK","KES","PAB","INR","CZK","MAD","TWD","PHP","ZAR","BOB","CDF","DASH","VES","ISK","MWK","BAM","TTD","XRP","JOD","RSD","HNL","BGN","GTQ","BWP","XMR","MMK","QAR","AOA","KWD","MUR","WUSD","WEUR","WAVES","WTRY","LRD","LSL","LYD","AWG","MDL","BTO","EURS","CHFT","MKD","MNT","MOP","MRO","MVR","VOLLAR","CKUSD","KHR","VUV","BITCNY","QC","BBD","NAD","NPR","PGK","PYG","BIF","BMD","BND","XLM","BNB","SCR","BAT","CRO","HT","KCS","LEO","LINK","MKR","NPXS","OMG","REP","ZB","ZIL","ZRX","BCH","BZD","CUP","CVE","DJF","DZD","ERN","ETB","FJD","FKP","BUSD","ANCT","ALL","AMD","ANG","CNYX","IQD","UZS","TND","GGP","XAU","KGS","GIP","JMD","ZEC","USDP","BSV","EMC2","SNT","GTO","POWR","EUSD","EURT","BCY","BTS","ATM","BLOCKPAY","ARDR","AMP","B2X","BITGOLD","BITEUR","ATB","BITUSD","AGRS","DFXT","HIKEN","BIX","KNC","EOS","COB","COSS","BMH","NANO","BDG","BNT","XVG","LKK1Y","LKK","USDK","EURN","NZDT","JSE","GMD","GNF","GYD","YER","XPF","HTG","SLL","SOS","WST","SVC","SYP","NEO","KMF","JUMP","AYA","BLAST","WGR","BCN","BTG","URALS","INN","USDQ","CNH","HUSD","BKRW","NZDX","EURX","CADX","USDEX","JPYX","AUDX","VNDC","EON","GBPX","CHFX","USDJ","IDRT","USDS","USDN","BIDR","IDK","BSD","BTN","KYD","NIO","SBD","SDG","SHP","TOP","XCD","XCHF","CNYT","GYEN","ZUSD","GOLD","TRX","TRYB","PLATC","STRAX","UST","GLM","VAI","BRZ","DDRST","XAUT","MIM"],Xn={[B.MOONPAY]:["AUD","BGN","BRL","CAD","CHF","CNY","COP","CZK","DKK","DOP","EGP","EUR","GBP","HKD","HRK","IDR","ILS","JPY","JOD","KES","KRW","KWD","LKR","MAD","MXN","MYR","NGN","NOK","NZD","OMR","PEN","PKR","PLN","RON","RUB","SEK","SGD","THB","TRY","TWD","USD","VND","ZAR"],[B.WYRE]:["USD","EUR","GBP","AUD","CAD","NZD","ARS","BRL","CHF","CLP","COP","CZK","DKK","HKD","ILS","INR","ISK","JPY","KRW","MXN","MYR","NOK","PHP","PLN","SEK","THB","VND","ZAR"],[B.RAMPNETWORK]:["USD","EUR","GBP"],[B.XANPOOL]:["SGD","HKD","THB","PHP","INR","IDR","MYR","AUD","NZD","KRW"],[B.MERCURYO]:["EUR","USD","GBP","TRY","JPY","BRL","NGN","VND","MXN","KRW"],[B.TRANSAK]:["ARS","AUD","BBD","BGN","BMD","BRL","CAD","CHF","CLP","CRC","CZK","DKK","DOP","EUR","FJD","FKP","GBP","GIP","HRK","HUF","IDR","ILS","ISK","JMD","JPY","KES","KRW","MDL","MXN","MYR","NOK","NZD","PEN","PHP","PLN","PYG","RON","SEK","SGD","THB","TRY","TZS","USD","ZAR"],[B.BANXA]:["EUR","GBP","USD"]},Jn=new Set(zn);function fe(r){return Xn[r].filter(t=>Jn.has(t))}const Zn={[B.MOONPAY]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"4.5% or 5 USD",line3:"2,000€/day, 10,000€/mo",supportPage:"https://help.moonpay.io/en/",minOrderValue:24.99,maxOrderValue:5e4,validCurrencies:fe(B.MOONPAY),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"aave",display:"AAVE"},{value:"bat",display:"BAT"},{value:"dai",display:"DAI"},{value:"eth",display:"ETH"},{value:"mkr",display:"MKR"},{value:"matic",display:"MATIC"},{value:"usdt",display:"USDT"},{value:"usdc",display:"USDC"}],[H.MATIC]:[{value:"eth_polygon",display:"ETH"},{value:"matic_polygon",display:"MATIC"},{value:"usdc_polygon",display:"USDC"}],[H.BSC_MAINNET]:[{value:"bnb_bsc",display:"BNB"},{value:"busd_bsc",display:"BUSD"}],[H.AVALANCHE_MAINNET]:[{value:"avax_cchain",display:"AVAX"}]},includeFees:!0,api:!0,enforceMax:!1},[B.WYRE]:{line1:"Apple Pay/ Debit/ Credit Card",line2:"4.9% + 30¢ or 5 USD",line3:"$250/day",supportPage:"https://support.sendwyre.com/en/",minOrderValue:5,maxOrderValue:500,validCurrencies:fe(B.WYRE),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"AAVE",display:"AAVE"},{value:"BAT",display:"BAT"},{value:"BUSD",display:"BUSD"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"MKR",display:"MKR"},{value:"UNI",display:"UNI"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[H.MATIC]:[{value:"MUSDC",display:"USDC"}],[H.AVALANCHE_MAINNET]:[{value:"AVAXC",display:"AVAXC"}]},includeFees:!1,api:!0,enforceMax:!1},[B.RAMPNETWORK]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000€/purchase, 20,000€/mo",supportPage:"https://instant.ramp.network/",minOrderValue:50,maxOrderValue:2e4,validCurrencies:fe(B.RAMPNETWORK),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"ETH",display:"ETH"},{value:"DAI",display:"DAI"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[H.MATIC]:[{value:"MATIC_DAI",display:"DAI"},{value:"MATIC_MATIC",display:"MATIC"},{value:"MATIC_USDC",display:"USDC"}],[H.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}]},includeFees:!0,api:!0,receiveHint:"walletTopUp.receiveHintRamp",enforceMax:!1},[B.XANPOOL]:{line1:"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ <br>ViettelPay/ DuitNow",line2:"2.5% buying, 3% selling",line3:"$2,500 / day",supportPage:"mailto:support@xanpool.com",minOrderValue:100,maxOrderValue:2500,validCurrencies:fe(B.XANPOOL),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDT",display:"USDT"}]},includeFees:!0,api:!0,sell:!0,enforceMax:!1},[B.MERCURYO]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"3.95% or 4 USD",line3:"10,000€/day, 25,000€/mo",supportPage:"mailto:support@mercuryo.io",minOrderValue:30,maxOrderValue:5e3,validCurrencies:fe(B.MERCURYO),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"ETH",display:"ETH"},{value:"BAT",display:"BAT"},{value:"USDT",display:"USDT"},{value:"DAI",display:"DAI"}],[H.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"},{value:"1INCH",display:"1INCH"}]},includeFees:!0,api:!0,enforceMax:!1},[B.TRANSAK]:{line1:"Apple & Google Pay / Credit/Debit Card<br/>Bangkok Bank Mobile & iPay<br/>Bank Transfer (sepa/gbp) / SCB Mobile & Easy",line2:"0.99% - 5.5% or 5 USD",line3:"$5,000/day, $28,000/mo",supportPage:"https://support.transak.com/hc/en-US",minOrderValue:30,maxOrderValue:500,validCurrencies:fe(B.TRANSAK),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[H.MATIC]:[{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"MATIC",display:"MATIC"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"},{value:"WETH",display:"WETH"}],[H.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"}],[H.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}]},includeFees:!0,enforceMax:!0},[B.BANXA]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000€/purchase, 20,000€/mo",supportPage:"https://support.banxa.com",minOrderValue:20,maxOrderValue:15e3,validCurrencies:fe(B.BANXA),validCryptoCurrenciesByChain:{[H.MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDT",display:"USDT"},{value:"BUSD",display:"BUSD"},{value:"LINK",display:"LINK"},{value:"USDC",display:"USDC"},{value:"CHZ",display:"CHZ"},{value:"BAT",display:"BAT"},{value:"MANA",display:"MANA"},{value:"AAVE",display:"AAVE"},{value:"COMP",display:"COMP"},{value:"ENJ",display:"ENJ"}],[H.MATIC]:[{value:"MATIC",display:"MATIC"}]},includeFees:!0,enforceMax:!0}},Qn={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}};var Q={supportedVerifierList:Object.values(pe),paymentProviders:Zn,api:"https://api.tor.us",translations:Qn,prodTorusUrl:"",localStorageKeyPrefix:"torus-"};const nr=r=>new Promise((e,t)=>{window.document.body!=null?Promise.resolve(r()).then(e).catch(t):window.document.addEventListener("DOMContentLoaded",()=>{Promise.resolve(r()).then(e).catch(t)})}),Me=r=>{const e=window.document.createElement("template"),t=r.trim();return e.innerHTML=t,e.content.firstChild},ei=function(r,e,t){for(var n=arguments.length,i=new Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];const d=()=>{t(...i),r.removeEventListener(e,d)};r.addEventListener(e,d)},Z=(r,e,t)=>{const n=i=>{t(i),r.removeListener(e,n)};r.on(e,n)};async function ti(){return new Promise(r=>{document.readyState!=="loading"?r():ei(document,"DOMContentLoaded",r)})}var k=Qe.getLogger("torus-embed"),G={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",sendSiteMetadata:()=>"Torus: Failed to send site metadata. This is an internal error, please report this bug.",unsupportedSync:r=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${r} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:(r,e)=>`Invalid options. Received: { maxEventListeners: ${r}, shouldSendMetadata: ${e} }`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:r=>`'args.logger' must include required method '${r}'.`},info:{connected:r=>`Torus: Connected to chain with ID "${r}".`},warnings:{enableDeprecation:'Torus: ""ethereum.enable()" is deprecated and may be removed in the future. Please use "ethereum.send("eth_requestAccounts")" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',sendDeprecation:`Torus: "ethereum.send(...)" is deprecated and may be removed in the future. Please use "ethereum.sendAsync(...)" or "ethereum.request(...)" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,events:{close:`Torus: The event "close" is deprecated and may be removed in the future. Please use "disconnect" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,data:`Torus: The event "data" is deprecated and will be removed in the future.Use "message" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193#message`,networkChanged:`Torus: The event "networkChanged" is deprecated and may be removed in the future. Please use "chainChanged" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,notification:`Torus: The event "notification" is deprecated and may be removed in the future. Please use "message" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`},publicConfigStore:'Torus: The property "publicConfigStore" is deprecated and WILL be removed in the future.'}};const{paymentProviders:ir}=Q,ri=(r,e)=>{const t={};if(!r)return{errors:t,isValid:!0};if(r&&!ir[r])return t.provider="Invalid Provider",{errors:t,isValid:Object.keys(t).length===0};const n=ir[r],i=e||{};if(i.fiatValue){const o=+parseFloat(i.fiatValue.toString())||0;o<n.minOrderValue&&(t.fiatValue="Requested amount is lower than supported"),o>n.maxOrderValue&&n.enforceMax&&(t.fiatValue="Requested amount is higher than supported")}if(i.selectedCurrency&&!n.validCurrencies.includes(i.selectedCurrency)&&(t.selectedCurrency="Unsupported currency"),i.selectedCryptoCurrency){const o=Object.values(n.validCryptoCurrenciesByChain).flat().map(f=>f.value),d=r===B.MOONPAY?i.selectedCryptoCurrency.toLowerCase():i.selectedCryptoCurrency;o&&!o.includes(d)&&(t.selectedCryptoCurrency="Unsupported cryptoCurrency")}return{errors:t,isValid:Object.keys(t).length===0}};function ni(){return(r,e,t)=>{(typeof r.method!="string"||!r.method)&&(e.error=ie.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:r})),t(n=>{const{error:i}=e;return i&&k.error(`MetaMask - RPC Error: ${i.message}`,i),n()})}}function sr(r,e,t){let n=`MetaMask: Lost connection to "${r}".`;e?.stack&&(n+=`
${e.stack}`),k.warn(n),t&&t.listenerCount("error")>0&&t.emit("error",n)}const ge=()=>Math.random().toString(36).slice(2),jr=async(r,e)=>{let t,n;const i="1.41.3";let o=e.version||i;try{if((r==="binance"||r==="production")&&!e.version){let d;Q.prodTorusUrl?d={data:Q.prodTorusUrl}:d=await _r(`${Q.api}/latestversion?name=@toruslabs/torus-embed&version=${i}`,{},{useAPIKey:!0}),o=d.data,Q.prodTorusUrl=d.data}}catch(d){k.error(d,"unable to fetch latest version")}switch(k.info("version used: ",o),r){case"binance":t=`https://binance.tor.us/v${o}`,n="info";break;case"testing":t="https://testing.tor.us",n="debug";break;case"bnb":t="https://bnb.tor.us",n="error";break;case"polygon":t="https://polygon.tor.us",n="error";break;case"lrc":t="https://lrc.tor.us",n="debug";break;case"beta":t="https://beta.tor.us",n="debug";break;case"development":t="http://localhost:4050",n="debug";break;default:t=`https://app.tor.us/v${o}`,n="error";break}return{torusUrl:t,logLevel:n}},ar=()=>{let r=window.navigator.language||"en-US";const e=r.split("-");return r=Object.prototype.hasOwnProperty.call(Q.translations,e[0])?e[0]:"en",r},ii=["eth_subscription"],Br=()=>{},or="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375",si="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315",dr="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450";function ai(){const r=window.screenLeft!==void 0?window.screenLeft:window.screenX,e=window.screenTop!==void 0?window.screenTop:window.screenY,t=1200,n=700,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,d=1,f=Math.abs((i-t)/2/d+r),h=Math.abs((o-n)/2/d+e);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${n/d},width=${t/d},top=${h},left=${f}`}function ur(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function oi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ur(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ur(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}tt.defaultMaxListeners=100;const lr=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(n,i)=>n||i.error?e(n||i.error):!t||Array.isArray(i)?r(i):r(i.result)};class ut extends tt{constructor(e){let{maxEventListeners:t=100,shouldSendMetadata:n=!0,jsonRpcStreamName:i="provider"}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(super(),g(this,"chainId",void 0),g(this,"selectedAddress",void 0),g(this,"_rpcEngine",void 0),g(this,"networkVersion",void 0),g(this,"shouldSendMetadata",void 0),g(this,"isTorus",void 0),g(this,"_publicConfigStore",void 0),g(this,"tryPreopenHandle",void 0),g(this,"enable",void 0),g(this,"_state",void 0),g(this,"_jsonRpcConnection",void 0),g(this,"_sentWarnings",{enable:!1,experimentalMethods:!1,send:!1,publicConfigStore:!1,events:{close:!1,data:!1,networkChanged:!1,notification:!1}}),!un.duplex(e))throw new Error(G.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(t),this._state=oi({},ut._defaultState),this.selectedAddress=null,this.networkVersion=null,this.chainId=null,this.shouldSendMetadata=n,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._sendSync=this._sendSync.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._warnOfDeprecation=this._warnOfDeprecation.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.send=this.send.bind(this),this.sendAsync=this.sendAsync.bind(this);const o=new Ar;Ge(e,o,e,this._handleStreamDisconnect.bind(this,"MetaMask")),this._publicConfigStore=new At.ObservableStore({storageKey:"Metamask-Config"}),Ge(o.createStream("publicConfig"),At.storeAsStream(this._publicConfigStore),sr.bind(this,"MetaMask PublicConfigStore")),o.ignoreStream("phishing"),this.on("connect",()=>{this._state.isConnected=!0});const d=yn();Ge(d.stream,o.createStream(i),d.stream,this._handleStreamDisconnect.bind(this,"MetaMask RpcProvider"));const f=new ne;f.push(bn()),f.push(ni()),f.push(d.middleware),this._rpcEngine=f,d.events.on("notification",h=>{const{method:v,params:_}=h;v==="wallet_accountsChanged"?this._handleAccountsChanged(_):v==="wallet_unlockStateChanged"?this._handleUnlockStateChanged(_):v==="wallet_chainChanged"?this._handleChainChanged(_):ii.includes(h.method)&&(this.emit("data",h),this.emit("notification",_.result),this.emit("message",{type:v,data:_}))})}get publicConfigStore(){return this._sentWarnings.publicConfigStore||(k.warn(G.warnings.publicConfigStore),this._sentWarnings.publicConfigStore=!0),this._publicConfigStore}isConnected(){return this._state.isConnected}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw ie.ethErrors.rpc.invalidRequest({message:G.errors.invalidRequestArgs(),data:e});const{method:t,params:n}=e;if(typeof t!="string"||t.length===0)throw ie.ethErrors.rpc.invalidRequest({message:G.errors.invalidRequestMethod(),data:e});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw ie.ethErrors.rpc.invalidRequest({message:G.errors.invalidRequestParams(),data:e});return new Promise((i,o)=>{this._rpcRequest({method:t,params:n},lr(i,o))})}sendAsync(e,t){this._rpcRequest(e,t)}addListener(e,t){return this._warnOfDeprecation(e),super.addListener(e,t)}on(e,t){return this._warnOfDeprecation(e),super.on(e,t)}once(e,t){return this._warnOfDeprecation(e),super.once(e,t)}prependListener(e,t){return this._warnOfDeprecation(e),super.prependListener(e,t)}prependOnceListener(e,t){return this._warnOfDeprecation(e),super.prependOnceListener(e,t)}async _initializeState(){try{const{accounts:e,chainId:t,isUnlocked:n,networkVersion:i}=await this.request({method:"wallet_getProviderState"});this.emit("connect",{chainId:t}),this._handleChainChanged({chainId:t,networkVersion:i}),this._handleUnlockStateChanged({accounts:e,isUnlocked:n}),this._handleAccountsChanged(e)}catch(e){k.error("MetaMask: Failed to get initial state. Please report this bug.",e)}finally{k.info("initialized state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t;const o=e;if(!Array.isArray(o)){if(o.jsonrpc||(o.jsonrpc="2.0"),o.method==="eth_accounts"||o.method==="eth_requestAccounts")i=(d,f)=>{this._handleAccountsChanged(f.result||[],o.method==="eth_accounts",n),t(d,f)};else if(o.method==="wallet_getProviderState"){this._rpcEngine.handle(e,i);return}}this.tryPreopenHandle(o,i)}send(e,t){return this._sentWarnings.send||(k.warn(G.warnings.sendDeprecation),this._sentWarnings.send=!0),typeof e=="string"&&(!t||Array.isArray(t))?new Promise((n,i)=>{try{this._rpcRequest({method:e,params:t},lr(n,i,!1))}catch(o){i(o)}}):e&&typeof e=="object"&&typeof t=="function"?this._rpcRequest(e,t):this._sendSync(e)}_sendSync(e){let t;switch(e.method){case"eth_accounts":t=this.selectedAddress?[this.selectedAddress]:[];break;case"eth_coinbase":t=this.selectedAddress||null;break;case"eth_uninstallFilter":this._rpcRequest(e,Br),t=!0;break;case"net_version":t=this.networkVersion||null;break;default:throw new Error(G.errors.unsupportedSync(e.method))}return{id:e.id,jsonrpc:e.jsonrpc,result:t}}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),k.debug(G.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let n;e?(n=new ie.EthereumRpcError(1013,t||G.errors.disconnected()),k.debug(n)):(n=new ie.EthereumRpcError(1011,t||G.errors.permanentlyDisconnected()),k.error(n),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}_handleStreamDisconnect(e,t){sr(e,t,this),this._handleDisconnect(!1,t?t.message:void 0)}_handleAccountsChanged(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=e;Array.isArray(i)||(k.error("MetaMask: Received non-array accounts parameter. Please report this bug.",i),i=[]);for(const o of e)if(typeof o!="string"){k.error("MetaMask: Received non-string account. Please report this bug.",e),i=[];break}ln(this._state.accounts,i)||(t&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!n&&k.error('MetaMask: "eth_accounts" unexpectedly updated accounts. Please report this bug.',i),this._state.accounts=i,this.emit("accountsChanged",i)),this.selectedAddress!==i[0]&&(this.selectedAddress=i[0]||null)}_handleChainChanged(){let{chainId:e,networkVersion:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!e||!t){k.error("MetaMask: Received invalid network parameters. Please report this bug.",{chainId:e,networkVersion:t});return}t==="loading"?this._handleDisconnect(!0):(this._handleConnect(e),e!==this.chainId&&(this.chainId=e,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:e,isUnlocked:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof t!="boolean"){k.error("MetaMask: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this._state.isUnlocked&&(this._state.isUnlocked=t,this._handleAccountsChanged(e||[]))}_warnOfDeprecation(e){this._sentWarnings.events[e]===!1&&(k.warn(G.warnings.events[e]),this._sentWarnings.events[e]=!0)}}g(ut,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});const di=r=>({algorithms:r.algorithms||["sha256"],delimiter:r.delimiter||" ",full:r.full||!1}),ui=(r,e)=>{const t={};return r.algorithms.forEach(n=>{t[n]=nn(n).update(e,"utf8").digest("base64")}),t},li=(r,e)=>{let t="";return t+=Object.keys(e.hashes).map(n=>`${n}-${e.hashes[n]}`).join(r.delimiter),t},ci=(r,e)=>{const t=di(r),n={hashes:ui(t,e),integrity:void 0};return n.integrity=li(t,n),t.full?n:n.integrity};class cr extends Pt{constructor(e){let{url:t,target:n,features:i}=e;super(),g(this,"url",void 0),g(this,"target",void 0),g(this,"features",void 0),g(this,"window",void 0),g(this,"windowTimer",void 0),g(this,"iClosedWindow",void 0),this.url=t,this.target=n||"_blank",this.features=i||ai(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){this.window=window.open(this.url.href,this.target,this.features),this.window?.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}function hr(r){return new Promise((e,t)=>{try{const n=document.createElement("img");n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=r}catch(n){t(n)}})}const hi=r=>{const{document:e}=r,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const n=e.querySelector('head > meta[name="title"]');return n?n.content:e.title&&e.title.length>0?e.title:r.location.hostname};async function fi(r){const{document:e}=r;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await hr(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(n=>!!n.href),t&&await hr(t.href))?t.href:null}const pi=async()=>({name:hi(window),icon:await fi(window)});async function gi(r){try{const e=await pi();r.handle({jsonrpc:"2.0",id:ge(),method:"wallet_sendDomainMetadata",params:e},Br)}catch(e){k.error({message:G.errors.sendSiteMetadata(),originalError:e})}}const mi=["host","chainId","networkName"];function fr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function wi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fr(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):fr(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const yi={[Ie.GOOGLE]:!0,[Ie.FACEBOOK]:!0,[Ie.REDDIT]:!0,[Ie.TWITCH]:!0,[Ie.DISCORD]:!0},Wr="sha384-QwEWmiPwBSE0zoVFrfYw+zFNBRwBhOo6NucsqlJnGOqpUEVaRo1UOMrAKDykq2WP",bi="max-age=3600",vi=["eth_sendTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","eth_getEncryptionPublicKey","eth_decrypt","wallet_addEthereumChain","wallet_switchEthereumChain"];(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{torusUrl:t}=await jr("production",{check:!1,hash:Wr,version:""});e.href=`${t}/popup`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){k.warn(e)}})();class _i{constructor(){let{buttonPosition:e=ve.BOTTOM_LEFT,buttonSize:t=56,modalZIndex:n=99999,apiKey:i="torus-default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g(this,"buttonPosition",ve.BOTTOM_LEFT),g(this,"buttonSize",void 0),g(this,"torusUrl",void 0),g(this,"torusIframe",void 0),g(this,"styleLink",void 0),g(this,"isLoggedIn",void 0),g(this,"isInitialized",void 0),g(this,"torusWidgetVisibility",void 0),g(this,"torusAlert",void 0),g(this,"apiKey",void 0),g(this,"modalZIndex",void 0),g(this,"alertZIndex",void 0),g(this,"torusAlertContainer",void 0),g(this,"isIframeFullScreen",void 0),g(this,"whiteLabel",void 0),g(this,"requestedVerifier",void 0),g(this,"currentVerifier",void 0),g(this,"embedTranslations",void 0),g(this,"ethereum",void 0),g(this,"provider",void 0),g(this,"communicationMux",void 0),g(this,"isLoginCallback",void 0),g(this,"paymentProviders",Q.paymentProviders),g(this,"loginHint",""),g(this,"useWalletConnect",void 0),g(this,"isCustomLogin",!1),this.buttonPosition=e,this.buttonSize=t,this.torusUrl="",this.isLoggedIn=!1,this.isInitialized=!1,this.torusWidgetVisibility=!0,this.requestedVerifier="",this.currentVerifier="",this.apiKey=i,sn(i),this.modalZIndex=n,this.alertZIndex=n+1e3,this.isIframeFullScreen=!1}async init(){let{buildEnv:e=Yn.PRODUCTION,enableLogging:t=!1,enabledVerifiers:n=yi,network:i={host:"mainnet",chainId:null,networkName:"",blockExplorer:"",ticker:"",tickerName:""},loginConfig:o={},showTorusButton:d=!0,integrity:f={check:!1,hash:Wr,version:""},whiteLabel:h,skipTKey:v=!1,useWalletConnect:_=!1,mfaLevel:m="default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");const{torusUrl:p,logLevel:S}=await jr(e,f);k.info(p,"url loaded"),this.torusUrl=p,this.whiteLabel=h,this.useWalletConnect=_,this.isCustomLogin=!!(o&&Object.keys(o).length>0)||!!(h&&Object.keys(h).length>0),k.setDefaultLevel(S),t?k.enableAll():k.disableAll(),this.torusWidgetVisibility=d;const R=new URL(p);R.pathname.endsWith("/")?R.pathname+="popup":R.pathname+="/popup",R.hash=`#isCustomLogin=${this.isCustomLogin}`,this.torusIframe=Me(`<iframe
        id="torusIframe"
        allow=${_?"camera":""}
        class="torusIframe"
        src="${R.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%; color-scheme: none;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}"
      ></iframe>`),this.torusAlertContainer=Me('<div id="torusAlertContainer"></div>'),this.torusAlertContainer.style.display="none",this.torusAlertContainer.style.setProperty("z-index",this.alertZIndex.toString());const O=window.document.createElement("link");O.setAttribute("rel","stylesheet"),O.setAttribute("type","text/css"),O.setAttribute("href",`${p}/css/widget.css`),this.styleLink=O;const{defaultLanguage:j=ar(),customTranslations:l={}}=this.whiteLabel||{},C=rn(Q.translations,l)[j]||Q.translations[ar()];this.embedTranslations=C.embed;const L=async()=>(await ti(),new Promise((x,ee)=>{this.torusIframe.onload=async()=>{this._setupWeb3();const te=this.communicationMux.getStream("init_stream");te.on("data",re=>{const{name:we,data:ye,error:J}=re;we==="init_complete"&&ye.success?(this.isInitialized=!0,this._displayIframe(this.isIframeFullScreen),x(void 0)):J&&ee(new Error(J))}),te.write({name:"init_stream",data:{enabledVerifiers:n,loginConfig:o,whiteLabel:this.whiteLabel,buttonPosition:this.buttonPosition,buttonSize:this.buttonSize,torusWidgetVisibility:this.torusWidgetVisibility,apiKey:this.apiKey,skipTKey:v,network:i,mfaLevel:m}})},window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer)}));if(e==="production"&&f.check){const x=`${p}/popup`,ee=await fetch(x,{cache:"reload"});if(ee.headers.get("Cache-Control")!==bi)throw new Error(`Unexpected Cache-Control headers, got ${ee.headers.get("Cache-Control")}`);const te=await ee.text(),re=ci({algorithms:["sha384"]},te);if(k.info(re,"integrity"),re===f.hash)await L();else throw this.clearInit(),new Error("Integrity check failed")}else await L()}login(){let{verifier:e="",login_hint:t=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");return this.requestedVerifier=e,this.loginHint=t,this.ethereum.enable()}logout(){return new Promise((e,t)=>{if(!this.isLoggedIn){t(new Error("User has not logged in yet"));return}this.communicationMux.getStream("logout").write({name:"logOut"});const i=this.communicationMux.getStream("status");Z(i,"data",d=>{d.loggedIn?t(new Error("Some Error Occured")):(this.isLoggedIn=!1,this.currentVerifier="",this.requestedVerifier="",e())})})}async cleanUp(){this.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(t){return t instanceof Element||t instanceof HTMLDocument}e(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),e(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),e(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.torusWidgetVisibility=!1,this._sendWidgetVisibilityStatus(!1),this._displayIframe()}showTorusButton(){this.torusWidgetVisibility=!0,this._sendWidgetVisibilityStatus(!0),this._displayIframe()}setProvider(e){let{host:t="mainnet",chainId:n=null,networkName:i=""}=e,o=cn(e,mi);return new Promise((d,f)=>{const h=this.communicationMux.getStream("provider_change");Z(h,"data",m=>{const{err:p,success:S}=m.data;k.info(m),p?f(p):S?d():f(new Error("some error occured"))});const _=ge();this._handleWindow(_,{target:"_blank",features:or}),h.write({name:"show_provider_change",data:{network:wi({host:t,chainId:n,networkName:i},o),preopenInstanceId:_,override:!1}})})}showWallet(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=this.communicationMux.getStream("show_wallet"),i=e?`/${e}`:"";n.write({name:"show_wallet",data:{path:i}}),Z(n,"data",d=>{if(d.name==="show_wallet_instance"){const{instanceId:f}=d.data,h=new URL(`${this.torusUrl}/wallet${i}`);h.searchParams.append("integrity","true"),h.searchParams.append("instanceId",f),Object.keys(t).forEach(_=>{h.searchParams.append(_,t[_])}),h.hash=`#isCustomLogin=${this.isCustomLogin}`,new cr({url:h,features:si}).open()}})}async getPublicAddress(e){let{verifier:t,verifierId:n,isExtended:i=!1}=e;if(!Q.supportedVerifierList.includes(t)||!rr[t])throw new Error("Unsupported verifier");const o=t,d=rr[t],f=new URL("https://api.tor.us/lookup/torus");return f.searchParams.append("verifier",d),f.searchParams.append("verifierId",n),f.searchParams.append("walletVerifier",o),f.searchParams.append("network","mainnet"),f.searchParams.append("isExtended",i.toString()),_r(f.href,{headers:{"Content-Type":"application/json; charset=utf-8"}},{useAPIKey:!0})}getUserInfo(e){return new Promise((t,n)=>{if(this.isLoggedIn){const i=this.communicationMux.getStream("user_info_access");i.write({name:"user_info_access_request"}),Z(i,"data",d=>{const{name:f,data:{approved:h,payload:v,rejected:_,newRequest:m}}=d;if(f==="user_info_access_response"){if(h)t(v);else if(_)n(new Error("User rejected the request"));else if(m){const p=this.communicationMux.getStream("user_info");Z(p,"data",O=>{O.name==="user_info_response"&&(O.data.approved?t(O.data.payload):n(new Error("User rejected the request")))});const R=ge();this._handleWindow(R,{target:"_blank",features:or}),p.write({name:"user_info_request",data:{message:e,preopenInstanceId:R}})}}})}else n(new Error("User has not logged in yet"))})}initiateTopup(e,t){return new Promise((n,i)=>{if(this.isInitialized){const{errors:o,isValid:d}=ri(e,t);if(!d){i(new Error(JSON.stringify(o)));return}const f=this.communicationMux.getStream("topup");Z(f,"data",_=>{_.name==="topup_response"&&(_.data.success?n(_.data.success):i(new Error(_.data.error)))});const v=ge();this._handleWindow(v),f.write({name:"topup_request",data:{provider:e,params:t,preopenInstanceId:v}})}else i(new Error("Torus is not initialized yet"))})}async loginWithPrivateKey(e){const{privateKey:t,userInfo:n}=e;return new Promise((i,o)=>{if(this.isInitialized){if(It.from(t,"hex").length!==32){o(new Error("Invalid private key, Please provide a 32 byte valid secp25k1 private key"));return}const d=this.communicationMux.getStream("login_with_private_key");Z(d,"data",h=>{h.name==="login_with_private_key_response"&&(h.data.success?i(h.data.success):o(new Error(h.data.error)))}),d.write({name:"login_with_private_key_request",data:{privateKey:t,userInfo:n}})}else o(new Error("Torus is not initialized yet"))})}async showWalletConnectScanner(){if(!this.useWalletConnect)throw new Error("Set `useWalletConnect` as true in init function options to use wallet connect scanner");return new Promise((e,t)=>{if(this.isLoggedIn){const n=this.communicationMux.getStream("wallet_connect_stream");Z(n,"data",o=>{o.name==="wallet_connect_stream_res"&&(o.data.success?e(o.data.success):t(new Error(o.data.error)),this._displayIframe())}),n.write({name:"wallet_connect_stream_req"}),this._displayIframe(!0)}else t(new Error("User has not logged in yet"))})}_handleWindow(e){let{url:t,target:n,features:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e){const o=this.communicationMux.getStream("window"),d=new URL(t||`${this.torusUrl}/redirect?preopenInstanceId=${e}`);d.hash?d.hash+=`&isCustomLogin=${this.isCustomLogin}`:d.hash=`#isCustomLogin=${this.isCustomLogin}`;const f=new cr({url:d,target:n,features:i});if(f.open(),!f.window){this._createPopupBlockAlert(e,d.href);return}o.write({name:"opened_window",data:{preopenInstanceId:e}});const h=v=>{let{preopenInstanceId:_,close:m}=v;_===e&&m&&(f.close(),o.removeListener("data",h))};o.on("data",h),f.once("close",()=>{o.write({data:{preopenInstanceId:e,closed:!0}}),o.removeListener("data",h)})}}_setEmbedWhiteLabel(e){const{theme:t}=this.whiteLabel||{};if(t){const{isDark:n=!1,colors:i={}}=t;n&&e.classList.add("torus-dark"),i.torusBrand1&&e.style.setProperty("--torus-brand-1",i.torusBrand1),i.torusGray2&&e.style.setProperty("--torus-gray-2",i.torusGray2)}}_getLogoUrl(){let e=`${this.torusUrl}/images/torus_icon-blue.svg`;return this.whiteLabel?.theme?.isDark?e=this.whiteLabel?.logoLight||e:e=this.whiteLabel?.logoDark||e,e}_sendWidgetVisibilityStatus(e){this.communicationMux.getStream("torus-widget-visibility").write({data:e})}_displayIframe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const t={},n=this.buttonSize+14;if(e)t.display="block",t.width="100%",t.height="100%",t.top="0px",t.right="0px",t.left="0px",t.bottom="0px";else switch(t.display=this.torusWidgetVisibility?"block":"none",t.height=`${n}px`,t.width=`${n}px`,this.buttonPosition){case ve.TOP_LEFT:t.top="0px",t.left="0px",t.right="auto",t.bottom="auto";break;case ve.TOP_RIGHT:t.top="0px",t.right="0px",t.left="auto",t.bottom="auto";break;case ve.BOTTOM_RIGHT:t.bottom="0px",t.right="0px",t.top="auto",t.left="auto";break;case ve.BOTTOM_LEFT:default:t.bottom="0px",t.left="0px",t.top="auto",t.right="auto";break}Object.assign(this.torusIframe.style,t),this.isIframeFullScreen=e}_setupWeb3(){k.info("setupWeb3 running");const e=new Kt({name:"embed_metamask",target:"iframe_metamask",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),t=new Kt({name:"embed_comm",target:"iframe_comm",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),n=new ut(e),i=_=>{const m=n[_];n[_]=function(S){if(S&&S==="eth_requestAccounts")return n.enable();for(var R=arguments.length,O=new Array(R>1?R-1:0),j=1;j<R;j++)O[j-1]=arguments[j];return m.apply(this,[S,...O])}};i("send"),i("sendAsync"),n.enable=()=>new Promise((_,m)=>{n.sendAsync({jsonrpc:"2.0",id:ge(),method:"eth_requestAccounts",params:[]},(p,S)=>{const{result:R}=S||{};if(p)setTimeout(()=>{m(p)},50);else if(Array.isArray(R)&&R.length>0){const O=()=>{if(this.requestedVerifier!==""&&this.currentVerifier!==this.requestedVerifier){const{requestedVerifier:j}=this;this.logout().then(l=>{this.requestedVerifier=j,this._showLoginPopup(!0,_,m)}).catch(l=>m(l))}else _(R)};this.isLoggedIn?O():this.isLoginCallback=O}else this._showLoginPopup(!0,_,m)})}),n.tryPreopenHandle=(_,m)=>{const p=_;if(!Array.isArray(p)&&vi.includes(p.method)){const S=ge();this._handleWindow(S,{target:"_blank",features:dr}),p.preopenInstanceId=S}n._rpcEngine.handle(p,m)};const o=new Proxy(n,{deleteProperty:()=>!0});this.ethereum=o;const d=Cn(t);this.communicationMux=d,d.getStream("window").on("data",_=>{_.name==="create_window"&&this._createPopupBlockAlert(_.data.preopenInstanceId,_.data.url)}),d.getStream("widget").on("data",_=>{const{data:m}=_;this._displayIframe(m)}),d.getStream("status").on("data",_=>{_.loggedIn?(this.isLoggedIn=_.loggedIn,this.currentVerifier=_.verifier):this._displayIframe(),this.isLoginCallback&&(this.isLoginCallback(),delete this.isLoginCallback)}),this.provider=o,this.provider.shouldSendMetadata&&gi(this.provider._rpcEngine),n._initializeState(),k.debug("Torus - injected provider")}_showLoginPopup(e,t,n){const i=d=>{const{err:f,selectedAddress:h}=d;f?(k.error(f),n&&n(f)):t&&t([h]),this.isIframeFullScreen&&this._displayIframe()},o=this.communicationMux.getStream("oauth");if(!this.requestedVerifier)this._displayIframe(!0),Z(o,"data",i),o.write({name:"oauth_modal",data:{calledFromEmbed:e}});else{Z(o,"data",i);const d=ge();this._handleWindow(d),o.write({name:"oauth",data:{calledFromEmbed:e,verifier:this.requestedVerifier,preopenInstanceId:d,login_hint:this.loginHint}})}}_createPopupBlockAlert(e,t){const n=this._getLogoUrl(),i=Me(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${n}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),o=Me(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),d=Me('<div id="torusAlert__btn-container"></div>');d.appendChild(o),i.appendChild(d);const f=()=>{o.addEventListener("click",()=>{this._handleWindow(e,{url:t,target:"_blank",features:dr}),i.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})};this._setEmbedWhiteLabel(i),nr(()=>{this.torusAlertContainer.style.display="block",this.torusAlertContainer.appendChild(i)}),nr(f)}}const Ei=an.ec;new Ei("secp256k1");const pr=globalThis.crypto||globalThis.msCrypto||{};pr.subtle||pr.webkitSubtle;It.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex");It.alloc(32,0);var Ci={},de={};Object.defineProperty(de,"__esModule",{value:!0});de.EthereumProviderError=de.EthereumRpcError=void 0;const Si=br;class Hr extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string.');super(t),this.code=e,n!==void 0&&(this.data=n)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return Si.default(this.serialize(),Ti,2)}}de.EthereumRpcError=Hr;class Oi extends Hr{constructor(e,t,n){if(!Ai(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}}de.EthereumProviderError=Oi;function Ai(r){return Number.isInteger(r)&&r>=1e3&&r<=4999}function Ti(r,e){if(e!=="[Circular]")return e}var xt={},ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.errorValues=ue.errorCodes=void 0;ue.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};ue.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.serializeError=r.isValidCode=r.getMessageFromCode=r.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=ue,t=de,n=e.errorCodes.rpc.internal,i="Unspecified error message. This is a bug, please report it.",o={code:n,message:d(n)};r.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function d(p,S=i){if(Number.isInteger(p)){const R=p.toString();if(m(e.errorValues,R))return e.errorValues[R].message;if(v(p))return r.JSON_RPC_SERVER_ERROR_MESSAGE}return S}r.getMessageFromCode=d;function f(p){if(!Number.isInteger(p))return!1;const S=p.toString();return!!(e.errorValues[S]||v(p))}r.isValidCode=f;function h(p,{fallbackError:S=o,shouldIncludeStack:R=!1}={}){var O,j;if(!S||!Number.isInteger(S.code)||typeof S.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(p instanceof t.EthereumRpcError)return p.serialize();const l={};if(p&&typeof p=="object"&&!Array.isArray(p)&&m(p,"code")&&f(p.code)){const C=p;l.code=C.code,C.message&&typeof C.message=="string"?(l.message=C.message,m(C,"data")&&(l.data=C.data)):(l.message=d(l.code),l.data={originalError:_(p)})}else{l.code=S.code;const C=(O=p)===null||O===void 0?void 0:O.message;l.message=C&&typeof C=="string"?C:S.message,l.data={originalError:_(p)}}const w=(j=p)===null||j===void 0?void 0:j.stack;return R&&p&&w&&typeof w=="string"&&(l.stack=w),l}r.serializeError=h;function v(p){return p>=-32099&&p<=-32e3}function _(p){return p&&typeof p=="object"&&!Array.isArray(p)?Object.assign({},p):p}function m(p,S){return Object.prototype.hasOwnProperty.call(p,S)}})(xt);var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.ethErrors=void 0;const Lt=de,Vr=xt,K=ue;lt.ethErrors={rpc:{parse:r=>$(K.errorCodes.rpc.parse,r),invalidRequest:r=>$(K.errorCodes.rpc.invalidRequest,r),invalidParams:r=>$(K.errorCodes.rpc.invalidParams,r),methodNotFound:r=>$(K.errorCodes.rpc.methodNotFound,r),internal:r=>$(K.errorCodes.rpc.internal,r),server:r=>{if(!r||typeof r!="object"||Array.isArray(r))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=r;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return $(e,r)},invalidInput:r=>$(K.errorCodes.rpc.invalidInput,r),resourceNotFound:r=>$(K.errorCodes.rpc.resourceNotFound,r),resourceUnavailable:r=>$(K.errorCodes.rpc.resourceUnavailable,r),transactionRejected:r=>$(K.errorCodes.rpc.transactionRejected,r),methodNotSupported:r=>$(K.errorCodes.rpc.methodNotSupported,r),limitExceeded:r=>$(K.errorCodes.rpc.limitExceeded,r)},provider:{userRejectedRequest:r=>De(K.errorCodes.provider.userRejectedRequest,r),unauthorized:r=>De(K.errorCodes.provider.unauthorized,r),unsupportedMethod:r=>De(K.errorCodes.provider.unsupportedMethod,r),disconnected:r=>De(K.errorCodes.provider.disconnected,r),chainDisconnected:r=>De(K.errorCodes.provider.chainDisconnected,r),custom:r=>{if(!r||typeof r!="object"||Array.isArray(r))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:t,data:n}=r;if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string');return new Lt.EthereumProviderError(e,t,n)}}};function $(r,e){const[t,n]=Kr(e);return new Lt.EthereumRpcError(r,t||Vr.getMessageFromCode(r),n)}function De(r,e){const[t,n]=Kr(e);return new Lt.EthereumProviderError(r,t||Vr.getMessageFromCode(r),n)}function Kr(r){if(r){if(typeof r=="string")return[r];if(typeof r=="object"&&!Array.isArray(r)){const{message:e,data:t}=r;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.getMessageFromCode=r.serializeError=r.EthereumProviderError=r.EthereumRpcError=r.ethErrors=r.errorCodes=void 0;const e=de;Object.defineProperty(r,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(r,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const t=xt;Object.defineProperty(r,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(r,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});const n=lt;Object.defineProperty(r,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});const i=ue;Object.defineProperty(r,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})})(Ci);function gr(r,e,t){try{Reflect.apply(r,e,t)}catch(n){setTimeout(()=>{throw n})}}function Ri(r){const e=r.length,t=new Array(e);for(let n=0;n<e;n+=1)t[n]=r[n];return t}class Pi extends Pt{emit(e){let t=e==="error";const n=this._events;if(n!==void 0)t=t&&n.error===void 0;else if(!t)return!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),d=1;d<i;d++)o[d-1]=arguments[d];if(t){let h;if(o.length>0&&([h]=o),h instanceof Error)throw h;const v=new Error(`Unhandled error.${h?` (${h.message})`:""}`);throw v.context=h,v}const f=n[e];if(f===void 0)return!1;if(typeof f=="function")gr(f,this,o);else{const h=f.length,v=Ri(f);for(let _=0;_<h;_+=1)gr(v[_],this,o)}return!0}}const ke="openlogin_store",Ni={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",DEVELOPMENT:"development",SK_TESTNET:"sk_testnet",CELESTE:"celeste",AQUA:"aqua"};Qe.setLevel("error");Qe.getLogger("openlogin");class Ii{constructor(){g(this,"store",{})}getItem(e){return this.store[e]||null}setItem(e,t){this.store[e]=t}}function qr(r){let e=!1,t=0,n;try{n=window[r],e=!0,t=n.length;const i="__storage_test__";return n.setItem(i,i),n.removeItem(i),!0}catch(i){return i&&(i.code===22||i.code===1014||i.name==="QuotaExceededErro r"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&t!==0}}const Mi=qr("sessionStorage"),Di=qr("localStorage");class ki{constructor(e,t){g(this,"storage",void 0),g(this,"_storeKey",ke),this.storage=e,this._storeKey=t||ke;try{e.getItem(t||ke)||this.resetStore()}catch{}}static getInstance(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){let n=new Ii;t==="local"&&Di&&(n=localStorage),t==="session"&&Mi&&(n=sessionStorage);const i=e?`${ke}_${e}`:ke;this.instance=new this(n,i)}return this.instance}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey))}get(e){return JSON.parse(this.storage.getItem(this._storeKey))[e]}set(e,t){const n=JSON.parse(this.storage.getItem(this._storeKey));n[e]=t,this.storage.setItem(this._storeKey,JSON.stringify(n))}}g(ki,"instance",void 0);const X={EIP155:"eip155",SOLANA:"solana",OTHER:"other"},xi={EIP155:"eip155",SOLANA:"solana",MULTICHAIN:"multichain"},Li=r=>{if(r===X.EIP155)return 1;if(r===X.SOLANA)return 1;throw new Error(`Chain namespace ${r} is not supported`)},Ui=r=>{const e=X.EIP155;return r===1?{chainNamespace:e,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/eth",displayName:"Ethereum Mainnet",blockExplorer:"https://etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:r===5?{chainNamespace:e,chainId:"0x5",rpcTarget:"https://rpc.ankr.com/eth_goerli",displayName:"Goerli Testnet",blockExplorer:"https://goerli.etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:r===11155111?{chainNamespace:e,chainId:"0xaa36a7",rpcTarget:"https://rpc.ankr.com/eth_sepolia",displayName:"Sepolia Testnet",blockExplorer:"https://sepolia.etherscan.io/",ticker:"ETH",tickerName:"Ethereum",decimals:18}:r===137?{chainNamespace:e,chainId:"0x89",rpcTarget:"https://rpc.ankr.com/polygon",displayName:"Polygon Mainnet",blockExplorer:"https://polygonscan.com",ticker:"MATIC",tickerName:"Polygon"}:r===80001?{chainNamespace:e,chainId:"0x13881",rpcTarget:"https://rpc.ankr.com/polygon_mumbai",displayName:"Polygon Mumbai Testnet",blockExplorer:"https://mumbai.polygonscan.com/",ticker:"MATIC",tickerName:"Polygon",decimals:18}:r===56?{chainNamespace:e,chainId:"0x38",rpcTarget:"https://rpc.ankr.com/bsc",displayName:"Binance SmartChain Mainnet",blockExplorer:"https://bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:r===97?{chainNamespace:e,chainId:"0x61",rpcTarget:"https://rpc.ankr.com/bsc_testnet_chapel",displayName:"Binance SmartChain Testnet",blockExplorer:"https://testnet.bscscan.com",ticker:"BNB",tickerName:"Binance SmartChain",decimals:18}:r===25?{chainNamespace:e,chainId:"0x19",rpcTarget:"https://rpc.cronos.org",displayName:"Cronos Mainnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos"}:r===338?{chainNamespace:e,chainId:"0x152",rpcTarget:"https://rpc-t3.cronos.org/",displayName:"Cronos Testnet",blockExplorer:"https://cronoscan.com/",ticker:"CRO",tickerName:"Cronos",decimals:18}:r===8217?{chainNamespace:e,chainId:"0x2019",rpcTarget:"https://public-node-api.klaytnapi.com/v1/cypress",displayName:"Klaytn Mainnet",blockExplorer:"https://scope.klaytn.com",ticker:"KLAY",tickerName:"Klaytn",decimals:18}:null},ji=r=>{const e=X.SOLANA;return r===1?{chainNamespace:e,chainId:"0x1",rpcTarget:"https://rpc.ankr.com/solana",displayName:"Solana Mainnet",blockExplorer:"https://explorer.solana.com",ticker:"SOL",tickerName:"Solana",decimals:9}:r===2?{chainNamespace:e,chainId:"0x2",rpcTarget:"https://api.testnet.solana.com",displayName:"Solana Testnet",blockExplorer:"https://explorer.solana.com?cluster=testnet",ticker:"SOL",tickerName:"Solana",decimals:9}:r===3?{chainNamespace:e,chainId:"0x3",rpcTarget:"https://api.devnet.solana.com",displayName:"Solana Devnet",blockExplorer:"https://explorer.solana.com?cluster=devnet",ticker:"SOL",tickerName:"Solana",decimals:9}:null},Fr=(r,e)=>{if(r===X.OTHER)return null;const t=e?typeof e=="number"?e:parseInt(e,16):Li(r);return r===X.EIP155?Ui(t):r===X.SOLANA?ji(t):null};class ct extends on{constructor(e,t){super(t),g(this,"code",void 0),g(this,"message",void 0),this.code=e,this.message=t||"",Object.defineProperty(this,"name",{value:"Web3AuthError"})}toJSON(){return{name:this.name,code:this.code,message:this.message}}toString(){return JSON.stringify(this.toJSON())}}class D extends ct{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletInitializationError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new D(e,`${D.messages[e]}, ${t}`)}static notFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5001,e)}static notInstalled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5002,e)}static notReady(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5003,e)}static windowBlocked(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5004,e)}static windowClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5005,e)}static incompatibleChainNameSpace(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5006,e)}static duplicateAdapterError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5007,e)}static invalidProviderConfigError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5008,e)}static providerNotReadyError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5009,e)}static rpcConnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5010,e)}static invalidParams(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5011,e)}static invalidNetwork(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.fromCode(5013,e)}}g(D,"messages",{5e3:"Custom",5001:"Wallet is not found",5002:"Wallet is not installed",5003:"Wallet is not ready yet",5004:"Wallet window is blocked",5005:"Wallet window has been closed by the user",5006:"Incompatible chain namespace provided",5007:"Adapter has already been included",5008:"Invalid provider Config",5009:"Provider is not ready yet",5010:"Failed to connect with rpc url",5011:"Invalid params passed in",5013:"Invalid network provided"});class U extends ct{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletLoginError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new U(e,`${U.messages[e]}. ${t}`)}static connectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5111,e)}static disconnectionError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5112,e)}static notConnectedError(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5113,e)}static popupClosed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5114,e)}static mfaEnabled(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5115,e)}static chainConfigNotAdded(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5116,e)}static unsupportedOperation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5117,e)}static coreKitKeyNotFound(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5118,e)}static userNotLoggedIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return U.fromCode(5119,e)}}g(U,"messages",{5e3:"Custom",5111:"Failed to connect with wallet",5112:"Failed to disconnect from wallet",5113:"Wallet is not connected",5114:"Wallet popup has been closed by the user",5115:"User has already enabled mfa, please use the @web3auth/web3auth-web sdk for login with mfa",5116:"Chain config has not been added. Please add the chain config before calling switchChain",5117:"Unsupported operation",5118:"useCoreKitKey flag is enabled but coreKitKey is not available",5119:"User not logged in."});class Ee extends ct{constructor(e,t){super(e,t),Object.defineProperty(this,"name",{value:"WalletOperationsError"})}static fromCode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Ee(e,`${Ee.messages[e]}, ${t}`)}static chainIDNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ee.fromCode(5201,e)}static operationNotAllowed(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ee.fromCode(5202,e)}}g(Ee,"messages",{5e3:"Custom",5201:"Provided chainId is not allowed",5202:"This operation is not allowed"});function mr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Xe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mr(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):mr(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const Le={OPENLOGIN:"openlogin",WALLET_CONNECT_V1:"wallet-connect-v1",WALLET_CONNECT_V2:"wallet-connect-v2"},xe=Xe({TORUS_SOLANA:"torus-solana",PHANTOM:"phantom",SOLFLARE:"solflare",SLOPE:"slope"},Le),Ye=Xe({TORUS_EVM:"torus-evm",METAMASK:"metamask",COINBASE:"coinbase"},Le),Ce=Xe(Xe({},Ye),xe);Le.OPENLOGIN+"",Le.WALLET_CONNECT_V1+"",Le.WALLET_CONNECT_V2+"",xe.TORUS_SOLANA+"",xe.PHANTOM+"",xe.SOLFLARE+"",xe.SLOPE+"",Ye.TORUS_EVM+"",Ye.METAMASK+"",Ye.COINBASE+"";function wr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function me(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wr(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):wr(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const Bi={EXTERNAL:"external",IN_APP:"in_app"},W={NOT_READY:"not_ready",READY:"ready",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected",ERRORED:"errored"},Ue=me(me({},W),{},{ADAPTER_DATA_UPDATED:"adapter_data_updated",CACHE_CLEAR:"cache_clear"});class Wi extends Pi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),g(this,"adapterData",{}),g(this,"sessionTime",86400),g(this,"clientId",void 0),g(this,"web3AuthNetwork",Ni.MAINNET),g(this,"rehydrated",!1),g(this,"chainConfig",null),g(this,"knownChainConfigs",{}),this.setAdapterSettings(e)}get chainConfigProxy(){return this.chainConfig?me({},this.chainConfig):null}setAdapterSettings(e){if(this.status===W.READY)return;e!=null&&e.sessionTime&&(this.sessionTime=e.sessionTime),e!=null&&e.clientId&&(this.clientId=e.clientId),e!=null&&e.web3AuthNetwork&&(this.web3AuthNetwork=e.web3AuthNetwork);const t=e.chainConfig;if(t){if(!t.chainNamespace)throw D.notReady("ChainNamespace is required while setting chainConfig");this.currentChainNamespace=t.chainNamespace;const n=Fr(t.chainNamespace,t.chainId),i=me(me({},n||{}),t);this.chainConfig=i,this.addChainConfig(i)}}checkConnectionRequirements(){if(!((this.name===Ce.WALLET_CONNECT_V1||this.name===Ce.WALLET_CONNECT_V2)&&this.status===W.CONNECTING)){if(this.status===W.CONNECTING)throw D.notReady("Already connecting");if(this.status===W.CONNECTED)throw U.connectionError("Already connected");if(this.status!==W.READY)throw U.connectionError("Wallet adapter is not ready yet, Please wait for init function to resolve before calling connect/connectTo function")}}checkInitializationRequirements(){if(!this.clientId)throw D.invalidParams("Please initialize Web3Auth with a valid clientId in constructor");if(!this.chainConfig||!this.chainConfig.rpcTarget&&this.chainConfig.chainNamespace!==X.OTHER)throw D.invalidParams("rpcTarget is required in chainConfig");if(!this.chainConfig.chainId&&this.chainConfig.chainNamespace!==X.OTHER)throw D.invalidParams("chainID is required in chainConfig");if(this.status!==W.NOT_READY){if(this.status===W.CONNECTED)throw D.notReady("Already connected");if(this.status===W.READY)throw D.notReady("Adapter is already initialized")}}checkDisconnectionRequirements(){if(this.status!==W.CONNECTED)throw U.disconnectionError("Not connected with wallet")}checkAddChainRequirements(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&!this.provider)throw U.notConnectedError("Not connected with wallet.")}checkSwitchChainRequirements(e){let{chainId:t}=e;if(!(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)&&!this.provider)throw U.notConnectedError("Not connected with wallet.");if(!this.knownChainConfigs[t])throw U.chainConfigNotAdded("Invalid chainId")}updateAdapterData(e){this.adapterData=e,this.emit(Ue.ADAPTER_DATA_UPDATED,{adapterName:this.name,data:e})}addChainConfig(e){const t=this.knownChainConfigs[e.chainId];this.knownChainConfigs[e.chainId]=me(me({},t||{}),e)}getChainConfig(e){return this.knownChainConfigs[e]||null}}const $r="https://authjs.web3auth.io";var ze=Qe.getLogger("web3auth-logger");function Ut(r){let e=!1,t=0,n;try{n=window[r],e=!0,t=n.length;const i="__storage_test__";return n.setItem(i,i),n.removeItem(i),!0}catch(i){const o=i;return!!(o&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&t!==0)}}const Hi=r=>{const e=dn(r);return!e.exp||e.exp<Math.floor(Date.now()/1e3)},Vi=async(r,e)=>{const o={payload:r,header:{t:e==="solana"?"sip99":"eip191"},network:e==="solana"?"solana":"ethereum"},d=await Er(`${$r}/siww/get`,o);if(!d.success)throw new Error("Failed to authenticate user, Please reach out to Web3Auth Support team");return d.challenge},Ki=async(r,e,t,n,i,o,d)=>{const h={signature:{s:e,t:r==="solana"?"sip99":"eip191"},message:t,issuer:n,audience:window.location.hostname,timeout:i},v=await Er(`${$r}/siww/verify`,h,{headers:{client_id:o,wallet_provider:n,web3auth_network:d}});if(!v.success)throw ze.error("Failed to authenticate user, ,message verification failed",v.error),new Error("Failed to authenticate user, ,message verification failed");return v.token},qi=(r,e)=>Ut("localStorage")?localStorage.getItem(`${r.toLowerCase()}_${e}`):null,Fi=(r,e,t)=>Ut("localStorage")?localStorage.setItem(`${r.toLowerCase()}_${e}`,t):null,$i=(r,e)=>Ut("localStorage")?localStorage.removeItem(`${r.toLowerCase()}_${e}`):null;class Gi extends Wi{async init(e){this.chainConfig||(this.chainConfig=Fr(X.EIP155,1))}async authenticateUser(){if(!this.provider||this.status!==W.CONNECTED)throw U.notConnectedError();const{chainNamespace:e,chainId:t}=this.chainConfig,n=await this.provider.request({method:"eth_accounts"});if(n&&n.length>0){const i=qi(n[0],this.name);if(i&&!Hi(i))return{idToken:i};const o={domain:window.location.origin,uri:window.location.href,address:n[0],chainId:parseInt(t,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},d=await Vi(o,e),f=await this.provider.request({method:"personal_sign",params:[d,n[0]]}),h=await Ki(e,f,d,this.name,this.sessionTime,this.clientId,this.web3AuthNetwork);return Fi(n[0],this.name,h),{idToken:h}}throw U.notConnectedError("Not connected with wallet, Please login/connect first")}async disconnectSession(){super.checkDisconnectionRequirements();const e=await this.provider.request({method:"eth_accounts"});e&&e.length>0&&$i(e[0],this.name)}async disconnect(){this.rehydrated=!1,this.emit(Ue.DISCONNECTED)}}function yr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Ot(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?yr(Object(t),!0).forEach(function(n){g(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):yr(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class Qi extends Gi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),g(this,"name",Ce.TORUS_EVM),g(this,"adapterNamespace",xi.EIP155),g(this,"currentChainNamespace",X.EIP155),g(this,"type",Bi.EXTERNAL),g(this,"status",W.NOT_READY),g(this,"torusInstance",null),g(this,"torusWalletOptions",void 0),g(this,"initParams",void 0),g(this,"loginSettings",{}),this.torusWalletOptions=e.adapterSettings||{},this.initParams=e.initParams||{},this.loginSettings=e.loginSettings||{}}get provider(){return this.status===W.CONNECTED&&this.torusInstance?this.torusInstance.provider:null}set provider(e){throw new Error("Not implemented")}async init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};await super.init(e),super.checkInitializationRequirements();const{chainId:t,blockExplorer:n,displayName:i,rpcTarget:o,ticker:d,tickerName:f}=this.chainConfig,h={chainId:Number.parseInt(t,16),host:o,blockExplorer:n,networkName:i,ticker:d,tickerName:f};this.torusInstance=new _i(this.torusWalletOptions),ze.debug("initializing torus evm adapter init"),await this.torusInstance.init(Ot(Ot({showTorusButton:!1},this.initParams),{},{network:h})),this.status=W.READY,this.emit(Ue.READY,Ce.TORUS_EVM);try{ze.debug("initializing torus evm adapter"),e.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(v){ze.error("Failed to connect with torus evm provider",v),this.emit(Ue.ERRORED,v)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw D.notReady("Torus wallet is not initialized");this.status=W.CONNECTING,this.emit(Ue.CONNECTING,{adapter:Ce.TORUS_EVM});try{await this.torusInstance.login(this.loginSettings);const{chainId:e}=this.torusInstance.provider;if(e&&parseInt(e)!==parseInt(this.chainConfig.chainId,16)){const{chainId:t,blockExplorer:n,displayName:i,rpcTarget:o,ticker:d,tickerName:f}=this.chainConfig,h={chainId:Number.parseInt(t,16),host:o,blockExplorer:n,networkName:i,tickerName:f,ticker:d};await this.torusInstance.setProvider(Ot({},h));const v=await this.torusInstance.ethereum.request({method:"eth_chainId"});if(v&&parseInt(v)!==parseInt(this.chainConfig.chainId,16))throw D.fromCode(5e3,`Not connected to correct chainId. Expected: ${this.chainConfig.chainId}, Current: ${v}`)}return this.status=W.CONNECTED,this.torusInstance.showTorusButton(),this.emit(W.CONNECTED,{adapter:Ce.TORUS_EVM,reconnected:this.rehydrated}),this.provider}catch(e){throw this.status=W.READY,this.rehydrated=!1,this.emit(W.ERRORED,e),e instanceof ct?e:U.connectionError("Failed to login with torus wallet")}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(await super.disconnectSession(),!this.torusInstance)throw D.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),this.torusInstance.hideTorusButton(),e.cleanup?(this.status=W.NOT_READY,this.torusInstance=null):this.status=W.READY,await super.disconnect()}async getUserInfo(){if(this.status!==W.CONNECTED)throw U.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw D.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo("")}async addChain(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(t),this.addChainConfig(e)}async switchChain(e){var t;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(e,n);const i=this.getChainConfig(e.chainId);await((t=this.torusInstance)===null||t===void 0?void 0:t.setProvider({host:i.rpcTarget,chainId:parseInt(i.chainId,16),networkName:i.displayName,blockExplorer:i.blockExplorer,ticker:i.ticker,tickerName:i.tickerName})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}}export{Qi as TorusWalletAdapter};
